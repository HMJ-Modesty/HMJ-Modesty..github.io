<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="Modesty" href="https://hmj-modesty.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="Modesty" href="https://hmj-modesty.github.io/atom.xml"><link rel="alternate" type="application/json" title="Modesty" href="https://hmj-modesty.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://hmj-modesty.github.io/2022/08/27/computer-science/AI-learn/AIlearn/opencv%E5%9F%BA%E7%A1%80/"><title>opencv 基础 - 人工智能基础 - 人工智能 - 计算机科学 | Yume Shoka = Modesty = 轩昂妄想</title><meta name="generator" content="Hexo 6.1.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">opencv 基础</h1><div class="meta"><span class="item" title="创建时间：2022-08-27 14:33:14"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-08-27T14:33:14+08:00">2022-08-27</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>32k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>29 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Yume Shoka</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giph4wqtg4j20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciukx8a7j20zk0m8aio.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciuv0socj20zk0m8qes.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclize41wj20zk0m87gk.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giph4fomxoj20zk0m8axp.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/AI-learn/" itemprop="item" rel="index" title="分类于 人工智能"><span itemprop="name">人工智能</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/computer-science/AI-learn/AIlearn/" itemprop="item" rel="index" title="分类于 人工智能基础"><span itemprop="name">人工智能基础</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://hmj-modesty.github.io/2022/08/27/computer-science/AI-learn/AIlearn/opencv%E5%9F%BA%E7%A1%80/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="Modesty"><meta itemprop="description" content="轩昂妄想, 欢迎来到 Modesty 妄想的 Blog!!!"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Modesty"></span><div class="body md" itemprop="articleBody"><h1 id="图像入门"><a class="anchor" href="#图像入门">#</a> 图像入门</h1><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 用灰度模式加载图像</span></pre></td></tr><tr><td data-num="6"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'app.jpg'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment">#使用 cv.imread () 函数读取一张图像，图片应该在工作目录中，或者应该提供完整的图像路径。</span></pre></td></tr><tr><td data-num="7"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span> <span class="token comment">#第一个参数是窗口名称，它是一个字符串。第二个参数是我们的对象。你可以根据需要创建任意多个窗口，但可以使用不同的窗口名称。</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token triple-quoted-string string">"""</span></pre></td></tr><tr><td data-num="10"></td><td><pre>cv.waitKey()是一个键盘绑定函数。</pre></td></tr><tr><td data-num="11"></td><td><pre>其参数是以毫秒为单位的时间。该函数等待任何键盘事件指定的毫秒。如果您在这段时间内按下任何键，</pre></td></tr><tr><td data-num="12"></td><td><pre>程序将继续运行。如果**0**被传递，它将无限期地等待一次敲击键。它也可以设置为检测特定的按键，例如，如果按下键 a 等</pre></td></tr><tr><td data-num="13"></td><td><pre>"""</pre></td></tr><tr><td data-num="14"></td><td><pre>cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>   <span class="token comment">#等待键盘输入</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># cv.destroyAllWindows ()  #销毁所有窗口</span></pre></td></tr><tr><td data-num="16"></td><td><pre>cv<span class="token punctuation">.</span>destroyWindow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span>  <span class="token comment">#销毁指定窗</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012121500.png" alt="image-20220827143807049"></p><h2 id="创建一个窗口加载图像"><a class="anchor" href="#创建一个窗口加载图像">#</a> 创建一个窗口加载图像</h2><p>cv.namedWindow('image',cv.WINDOW_NORMAL)</p><p><strong>注意</strong> 在特殊情况下，你可以创建一个空窗口，然后再将图像加载到该窗口。在这种情况下，你可以指定窗口是否可调整大小。这是通过功能<strong> cv.namedWindow</strong> () 完成的。默认情况下，该标志为<strong> cv.WINDOW_AUTOSIZE</strong>。但是，如果将标志指定为<strong> cv.WINDOW_NORMAL</strong>，则可以调整窗口大小。当图像尺寸过大以及向窗口添加跟踪栏时，这将很有帮助。</p><p>参考代码</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>cv<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">'image'</span>，cv<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span>  <span class="token comment">#窗口名字要与后面名字一样</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span>，img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="写入图像"><a class="anchor" href="#写入图像">#</a> 写入图像</h2><p>使用函数<strong> cv.imwrite</strong> () 保存图像</p><p>第一个参数是文件名，第二个参数是要保存的图像。 <code>cv.imwrite('messigray.png'，img)</code></p><p>这会将图像以 PNG 格式保存在工作目录中。</p><h3 id="列题"><a class="anchor" href="#列题">#</a> 列题：</h3><p>在下面的程序中，以灰度加载图像，显示图像，按 <code>s</code> 保存图像并退出，或者按 <code>ESC</code> 键直接退出而不保存。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>cv<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span>img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>k <span class="token operator">=</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    cv<span class="token punctuation">.</span>destroyWindow<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">elif</span> k <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'s'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'out1.png'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    cv<span class="token punctuation">.</span>destroyWindow<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>警告</strong></p><p>如果使用的是 64 位计算机，则必须 <code>k = cv.waitKey(0)</code> 按如下所示修改行： <code>k = cv.waitKey(0) &amp; 0xFF</code></p><h2 id="使用matplotlib"><a class="anchor" href="#使用matplotlib">#</a> 使用 Matplotlib</h2><p>Matplotlib 是 Python 的绘图库，可为你提供多种绘图方法。你将在接下来的文章中看到它们。在这里，你将学习如何使用 Matplotlib 显示图像。你可以使用 Matplotlib 缩放图像，保存图像等。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'gray'</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span><span class="token string">'bicubic'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="视频入门"><a class="anchor" href="#视频入门">#</a> 视频入门</h1><h3 id="目标"><a class="anchor" href="#目标">#</a> 目标</h3><ul><li>学习读取视频，显示视频和保存视频。</li><li>学习从相机捕捉并显示它。</li><li>你将学习以下功能：<strong>cv.VideoCapture</strong>()，<strong>cv.VideoWriter</strong>()</li></ul><h2 id="从相机中读取视频"><a class="anchor" href="#从相机中读取视频">#</a> 从相机中读取视频</h2><p>通常情况下，我们必须用摄像机捕捉实时画面。提供了一个非常简单的界面。让我们从摄像头捕捉一段视频 (我使用的是我笔记本电脑内置的网络摄像头) ，将其转换成灰度视频并显示出来。只是一个简单的任务开始。</p><p>要捕获视频，你需要创建一个 <strong>Video Capture</strong> 对象。它的参数可以是设备索引或视频文件的名称。设备索引就是指定哪个摄像头的数字。正常情况下，一个摄像头会被连接 (就像我的情况一样)。所以我简单地传 0 (或 - 1)。你可以通过传递 1 来选择第二个相机，以此类推。在此之后，你可以逐帧捕获。但是在最后，不要忘记释放俘虏。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>cap <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">if</span> <span class="token keyword">not</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'没有检测到相机'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment"># 逐帧捕获</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># 如果正确读取帧，ret 为 True</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"不能接收帧(流结束?)退出……"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 我们在框架上的操作到这里</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment"># 显示结果帧 e</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token keyword">if</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 完成所有操作后，释放捕获器</span></pre></td></tr><tr><td data-num="22"></td><td><pre>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><code>cap.read()</code> 返回布尔值 ( <code>True</code> / <code>False</code> )。如果正确读取了帧，它将为 <code>True</code> 。因此，你可以通过检查此返回值来检查视频的结尾。</p><p>有时，cap 可能尚未初始化捕获。在这种情况下，此代码显示错误。你可以通过<strong> cap.isOpened</strong> () 方法检查它是否已初始化。如果是 <code>True</code> ，那么确定。否则，使用<strong> cap.open</strong> () 打开它。</p><p>你还可以使用 <code>cap.get(propId)</code> 方法访问该视频的某些功能，其中 propId 是 0 到 18 之间的一个数字。每个数字表示视频的属性（如果适用于该视频），并且可以显示完整的详细信息在这里看到：<strong>cv::Video Capture::get()</strong>。其中一些值可以使用 <code>cap.set(propId，value)</code> 进行修改。 <code>value</code> 是你想要的新值。</p><p>例如，我可以通过 <code>cap.get(cv.CAP_PROP_FRAME_WIDTH)</code> 和 <code>cap.get(cv.CAP_PROP_FRAME_HEIGHT)</code> 检查框架的宽度和高度。默认情况下，它的分辨率为 640x480。但我想将其修改为 320x240。只需使用和即可。 <code>ret = cap.set(cv.CAP_PROP_FRAME_WIDTH,320)</code> and <code>ret = cap.set(cv.CAP_PROP_FRAME_HEIGHT,240)</code> .</p><blockquote><p><strong>注意</strong> 如果出现错误，请确保使用任何其他相机应用程序 (例如 Linux 中的 Cheese) 都可以正常使用相机。</p></blockquote><h2 id="从视频文件中读取视频"><a class="anchor" href="#从视频文件中读取视频">#</a> 从视频文件中读取视频</h2><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>cap <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'E:/python/deeplearn/video001.mp4'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">if</span> <span class="token keyword">not</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'没有检测到相机'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">while</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment"># 逐帧捕获</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># 如果正确读取帧，ret 为 True</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"不能接收帧(流结束?)退出……"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 我们在框架上的操作到这里</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment"># 显示结果帧 e</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span> gray<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token keyword">if</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment"># 完成所有操作后，释放捕获器</span></pre></td></tr><tr><td data-num="23"></td><td><pre>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>遇到问题：不能够读取视频 <code>cap.isOpened()</code> 返回 false</strong></p><p><strong>解决方法：将 opencv 文件中的 <code>opencv_videoio_ffmpeg460_64.dll</code> 文件从 opencv 库文件中复制到解释器安装目录</strong>・</p><h2 id="保存视频"><a class="anchor" href="#保存视频">#</a> 保存视频</h2><p>所以我们捕捉一个视频，一帧一帧地处理，我们想要保存这个视频。对于图像，它非常简单，只需使用 <strong>cv.imwrite</strong> ()。这里还需要做一些工作。</p><p>这次我们创建一个 <strong>VideoWriter</strong> 对象。我们应该指定输出文件名 (例如: output.avi)。然后我们应该指定 <strong>FourCC</strong> 代码 (详见下一段)。然后传递帧率的数量和帧大小。最后一个是颜色标志。如果为 <code>True</code> ，编码器期望颜色帧，否则它与灰度帧一起工作</p><p>FourCC：<span class="exturl" data-url="aHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9Gb3VyQ0M=">http://en.wikipedia.org/wiki/FourCC</span> 是用于指定视频编解码器的 4 字节代码。可用代码列表可在 fourcc.org 中:<span class="exturl" data-url="aHR0cDovL3d3dy5mb3VyY2Mub3JnL2NvZGVjcy5waHA=">http://www.fourcc.org/codecs.php</span> 找到。它取决于平台。遵循编解码器对我来说效果很好。</p><ul><li>在 Fedora 中：DIVX，XVID，MJPG，X264，WMV1，WMV2。（最好使用 XVID。MJPG 会生成大尺寸的视频。X264 会生成非常小的尺寸的视频）</li><li>在 Windows 中：DIVX（尚待测试和添加）</li><li>在 OSX 中：MJPG（.mp4），DIVX（.avi），X264（.mkv）。</li></ul><p>FourCC 代码作为 MJPG 的 <code>cv.VideoWriter_fourcc（'M'，'J'，'P'，'G'）</code> or <code>cv.VideoWriter_fourcc（*'MJPG'）</code> 传递。</p><p>在从摄像机捕获的代码下面，沿垂直方向翻转每一帧并保存。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="3"></td><td><pre>cap <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 定义编解码器并创建 VideoWriter 对象</span></pre></td></tr><tr><td data-num="5"></td><td><pre>fourcc <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoWriter_fourcc<span class="token punctuation">(</span><span class="token operator">*</span><span class="token string">'XVID'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>out <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoWriter<span class="token punctuation">(</span><span class="token string">'output.avi'</span><span class="token punctuation">,</span> fourcc<span class="token punctuation">,</span> <span class="token number">20.0</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">640</span><span class="token punctuation">,</span>  <span class="token number">480</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">while</span> cap<span class="token punctuation">.</span>isOpened<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    ret<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">if</span> <span class="token keyword">not</span> ret<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Can't receive frame (stream end?). Exiting ..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    frame <span class="token operator">=</span> cv<span class="token punctuation">.</span>flip<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 写翻转的框架</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    out<span class="token punctuation">.</span>write<span class="token punctuation">(</span>frame<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">if</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token builtin">ord</span><span class="token punctuation">(</span><span class="token string">'q'</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment"># 完成工作后释放所有内容</span></pre></td></tr><tr><td data-num="19"></td><td><pre>cap<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>out<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="opencv中的绘图功能"><a class="anchor" href="#opencv中的绘图功能">#</a> OpenCV 中的绘图功能</h1><h2 id="目标-2"><a class="anchor" href="#目标-2">#</a> 目标</h2><ul><li>学习使用 OpenCV 绘制不同的几何形状</li><li>您将学习以下功能：<strong>cv.line()</strong>，<strong>cv.circle()</strong>，<strong>cv.rectangle()</strong>，<strong>cv.ellipse()</strong>，<strong>cv.putText</strong> () 等。</li></ul><h2 id="代码样式"><a class="anchor" href="#代码样式">#</a> 代码样式</h2><p>在上述所有功能中，您将看到一些常见的参数，如下所示：</p><ul><li>img：您要绘制形状的图像</li><li>plt1 起始点，plt2 结束点</li><li>color：形状的颜色。对于 BGR，将其作为元组传递，例如：(255,0,0) 对于蓝色。对于灰度，只需传递标量值即可。</li><li>厚度：线或圆等的粗细。如果对闭合图形（如圆）传递 <code>-1</code> ，它将填充形状。<em>默认厚度 = 1</em></li><li>lineType：线的类型，是否为 8 连接线，抗锯齿线等。<em>默认情况下</em>，为 8 连接线。<strong>cv.LINE_AA</strong> 给出了抗锯齿的线条，看起来非常适合曲线。</li></ul><p>eg. <code>cv.line(img,(384,0),(510,128),(0,255,0),3)</code></p><p>​ <code>cv.circle(img,(384,0),(510,128),(0,255,0),3)</code></p><h4 id="画线"><a class="anchor" href="#画线">#</a> 画线</h4><p>要绘制一条线，您需要传递线的开始和结束坐标。我们将创建一个黑色图像，并从左上角到右下角在其上绘制一条蓝线。</p><pre><code>import numpy as np
import cv2 as cv
# 创建黑色的图像
img = np.zeros((512,512,3), np.uint8)
# 绘制一条厚度为5的蓝色对角线
cv.line(img,(0,0),(511,511),(255,0,0),5)
</code></pre><h4 id="画矩形"><a class="anchor" href="#画矩形">#</a> 画矩形</h4><p>要绘制矩形，您需要矩形的左上角和右下角。这次，我们将在图像的右上角绘制一个绿色矩形。 <code>cv.rectangle(img,(384,0),(510,128),(0,255,0),3)</code></p><h4 id="画圆圈"><a class="anchor" href="#画圆圈">#</a> 画圆圈</h4><p>要绘制一个圆，需要其中心坐标和半径。我们将在上面绘制的矩形内绘制一个圆。 <code>cv.circle(img,(447,63), 63, (0,0,255), -1)</code></p><h4 id="画椭圆"><a class="anchor" href="#画椭圆">#</a> 画椭圆</h4><p>要绘制椭圆，我们需要传递几个参数。一个参数是中心位置（x，y）。下一个参数是轴长度（长轴长度，短轴长度）。angle 是椭圆沿逆时针方向旋转的角度。startAngle 和 endAngle 表示从主轴沿顺时针方向测量的椭圆弧的开始和结束。即给出 0 和 360 给出完整的椭圆。有关更多详细信息，请参阅<strong> cv.ellipse</strong> 的文档。下面的示例在图像的中心绘制一个椭圆形。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>cv<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h4 id="画多边形"><a class="anchor" href="#画多边形">#</a> 画多边形</h4><p>要绘制多边形，首先需要顶点的坐标。将这些点组成形状为 <code>ROWSx1x2</code> 的数组，其中 <code>ROWS</code> 是顶点数，并且其类型应为 int32。在这里，我们绘制了一个带有四个顶点的黄色小多边形。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>pts <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>pts <span class="token operator">=</span> pts<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>cv<span class="token punctuation">.</span>polylines<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">[</span>pts<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p><strong>注意</strong> 如果第三个参数为 False，您将获得一条连接所有点的折线，而不是闭合形状。 <strong>cv.polylines</strong> () 可用于绘制多条线。只需创建要绘制的所有线条的列表，然后将其传递给函数即可。所有线条将单独绘制。与为每条线调用<strong> cv.line</strong> 相比，绘制一组线是一种更好，更快的方法。</p></blockquote><h4 id="向图像添加文本"><a class="anchor" href="#向图像添加文本">#</a> 向图像添加文本：</h4><p>要将文本放入图像中，需要指定以下内容。 - 您要写入的文字数据 - 您要放置它的位置坐标（即数据开始的左下角）。 - 字体类型（检查<strong> cv.putText</strong> 文档以获取受支持的字体） - 字体比例（指定字体大小） - 常规的内容，例如颜色，厚度，线条类型等。为了获得更好的外观，建议使用 lineType = <strong>cv.LINE_AA</strong>。</p><p>我们将在白色图像上写入<strong> OpenCV</strong>。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>font <span class="token operator">=</span> cv<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX</pre></td></tr><tr><td data-num="2"></td><td><pre>cv<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token string">'OpenCV'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span></pre></td></tr></table></figure><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 创建黑色的图像</span></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span><span class="token number">512</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 绘制一条厚度为 5 的蓝色对角线</span></pre></td></tr><tr><td data-num="6"></td><td><pre>cv<span class="token punctuation">.</span>line<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">511</span><span class="token punctuation">,</span><span class="token number">511</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#画矩形</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cv<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">139</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#画圆圈</span></pre></td></tr><tr><td data-num="10"></td><td><pre>cv<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">447</span><span class="token punctuation">,</span><span class="token number">63</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">63</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#画椭圆</span></pre></td></tr><tr><td data-num="12"></td><td><pre>cv<span class="token punctuation">.</span>ellipse<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">180</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#画多边形</span></pre></td></tr><tr><td data-num="14"></td><td><pre>pts <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>int32<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>pts <span class="token operator">=</span> pts<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>cv<span class="token punctuation">.</span>polylines<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">[</span>pts<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">True</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#向图像添加文本</span></pre></td></tr><tr><td data-num="18"></td><td><pre>font <span class="token operator">=</span> cv<span class="token punctuation">.</span>FONT_HERSHEY_SIMPLEX</pre></td></tr><tr><td data-num="19"></td><td><pre>cv<span class="token punctuation">.</span>putText<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token string">'OpenCV'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> font<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>LINE_AA<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'draw'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>cv<span class="token punctuation">.</span>destroyWindow<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h1 id="鼠标画笔"><a class="anchor" href="#鼠标画笔">#</a> 鼠标画笔</h1><h2 id="目标-3"><a class="anchor" href="#目标-3">#</a> 目标</h2><ul><li>了解如何在 OpenCV 中处理鼠标事件</li><li>您将学习以下功能：<strong>cv.setMouseCallback()</strong></li></ul><h2 id="补充"><a class="anchor" href="#补充">#</a> 补充:</h2><h3 id="参数"><a class="anchor" href="#参数">#</a> 参数：</h3><p>winname: 窗口名称</p><p>OnMouse : 鼠标事件的回调函数</p><p>userdata : 传递给回调函数的参数</p><p>MouseCallback 函数定义为：</p><p>typedef void(* cv::MouseCallback)(int event,int x,int y,int flags,void *useradata);</p><h3 id="参数说明"><a class="anchor" href="#参数说明">#</a> 参数说明：</h3><p>event: 鼠标事件</p><p>x : 鼠标事件的 x 坐标</p><p>y : 鼠标事件的 y 坐标</p><p>flags: 鼠标事件的标志</p><p>userdata : 可选的参数</p><h3 id="鼠标事件主要有下面几种"><a class="anchor" href="#鼠标事件主要有下面几种">#</a> 鼠标事件主要有下面几种：</h3><p>CV_EVENT_MOUSEMOVE ：鼠标移动</p><p>CV_EVENT_LBUTTONDOWN : 鼠标左键按下</p><p>CV_EVENT_RBUTTONDOWN : 鼠标右键按下</p><p>CV_EVENT_MBUTTONDOWN ： 鼠标中键按下</p><p>CV_EVENT_LBUTTONUP ： 鼠标左键放开</p><p>CV_EVENT_RBUTTONUP ： 右键放开</p><p>CV_EVENT_MBUTTONUP ： 中键放开</p><p>CV_EVENT_LBUTTONDBLCLK ： 左键双击</p><p>CV_EVENT_RBUTTONDBLCLK ： 右键双击</p><p>CV_EVENT_MBUTTONDBLCLK ： 中键双击</p><p>CV_EVENT_MOUSEWHEEL ： 鼠标向前（+）或向后（-）滑动</p><p>CV_EVENT_MOUSEHWHEEL ： 鼠标向右（+）或向左（-）滑动</p><p>Flags 主要有一下几种：</p><p>CV_EVENT_FLAG_LBUTTON ：左键拖拽</p><p>CV_EVENT_FLAG_RBUTTON ： 右键拖拽</p><p>CV_EVENT_FLAG_MBUTTON ： 中键拖拽</p><p>CV_EVENT_FLAG_CTRLKEY ： Ctrl 按下不放</p><p>CV_EVENT_FLAG_SHIFTKEY ： shift 按下不放</p><p>CV_EVENT_FLAG_ALTKEY ： alt 按下不放</p><h2 id="代码演示"><a class="anchor" href="#代码演示">#</a> 代码演示</h2><p>现在我们去寻找一个更好的应用。在这里，我们通过拖动鼠标来绘制矩形或圆形 (取决于我们选择的模式) ，就像我们在 Paint 应用程序中所做的那样。所以我们的鼠标回调函数有两部分，一部分用于绘制矩形，另一部分用于绘制圆形。这个具体的例子对于创建和理解一些交互式应用程序非常有帮助，比如目标跟踪，图像分割地图等等。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>drawing <span class="token operator">=</span> <span class="token boolean">False</span>  <span class="token comment"># 如果按下鼠标，则为真</span></pre></td></tr><tr><td data-num="5"></td><td><pre>mode <span class="token operator">=</span> <span class="token boolean">True</span>  <span class="token comment"># 如果为真，绘制矩形。按 m 键可以切换到曲线</span></pre></td></tr><tr><td data-num="6"></td><td><pre>ix<span class="token punctuation">,</span> iy <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 鼠标回调函数</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">def</span> <span class="token function">draw_circle</span><span class="token punctuation">(</span>event<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> flags<span class="token punctuation">,</span> param<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token keyword">global</span> ix<span class="token punctuation">,</span> iy<span class="token punctuation">,</span> drawing<span class="token punctuation">,</span> mode</pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> event <span class="token operator">==</span> cv<span class="token punctuation">.</span>EVENT_LBUTTONDOWN<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        drawing <span class="token operator">=</span> <span class="token boolean">True</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        ix<span class="token punctuation">,</span> iy <span class="token operator">=</span> x<span class="token punctuation">,</span> y</pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">elif</span> event <span class="token operator">==</span> cv<span class="token punctuation">.</span>EVENT_MOUSEMOVE<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">if</span> drawing <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                cv<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>ix<span class="token punctuation">,</span> iy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                cv<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">elif</span> event <span class="token operator">==</span> cv<span class="token punctuation">.</span>EVENT_LBUTTONUP<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        drawing <span class="token operator">=</span> <span class="token boolean">False</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">if</span> mode <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            cv<span class="token punctuation">.</span>rectangle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>ix<span class="token punctuation">,</span> iy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            cv<span class="token punctuation">.</span>circle<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">156</span><span class="token punctuation">,</span> <span class="token number">190</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>img <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>cv<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>cv<span class="token punctuation">.</span>setMouseCallback<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> draw_circle<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">if</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span> <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="36"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>上述代码将 15~20 行注释掉就可以变成绘制一个未填充的矩形。</p><h1 id="轨迹栏作为调色板"><a class="anchor" href="#轨迹栏作为调色板">#</a> 轨迹栏作为调色板</h1><h2 id="目标-4"><a class="anchor" href="#目标-4">#</a> 目标</h2><ul><li>了解将轨迹栏固定到 OpenCV 窗口</li><li>您将学习以下功能：<strong>cv.getTrackbarPos</strong>，<strong>cv.createTrackbar</strong> 等。</li></ul><h2 id="代码演示-2"><a class="anchor" href="#代码演示-2">#</a> 代码演示</h2><p>在这里，我们将创建一个简单的应用程序，以显示您指定的颜色。您有一个显示颜色的窗口，以及三个用于指定 B、G、R 颜色的跟踪栏。滑动轨迹栏，并相应地更改窗口颜色。默认情况下，初始颜色将设置为黑色。</p><p>对于 <code>cv.getTrackbarPos()</code> 函数，第一个参数是轨迹栏名称，第二个参数是它附加到的窗口名称，第三个参数是默认值，第四个参数是最大值，第五个是执行的回调函数每次跟踪栏值更改。回调函数始终具有默认参数，即轨迹栏位置。在我们的例子中，函数什么都不做，所以我们简单地通过。</p><p>轨迹栏的另一个重要应用是将其用作按钮或开关。默认情况下，OpenCV 不具有按钮功能。因此，您可以使用轨迹栏获得此类功能。在我们的应用程序中，我们创建了一个开关，只有在该开关为 ON 的情况下，该应用程序才能在其中运行，否则屏幕始终为黑色。</p><h3 id="创建滑动条createtrackbar-函数"><a class="anchor" href="#创建滑动条createtrackbar-函数">#</a> <strong>创建滑动条：createTrackbar 函数</strong></h3><p>createTrackbar 函数用于创建一个可以调整数值的滑动条，并将滑动条附加在指定的窗口上。</p><blockquote><p>int createTrackbar(const string&amp; trackbar_name,const string&amp; window_name,int* value,int count,TrackbarCallback onChange=0,void* userdata=0);</p></blockquote><ul><li>trackbar_name，轨迹条的名字。</li><li>window_name，窗口名字。</li><li>value，滑块位置，滑块的初始位置为该变量的初始值。</li><li>count，滑块可以达到的最大位置，最小位置始终为 0。</li><li>onChange，默认值为 0。这是一个指向回调函数的指针，每次滑块位置改变，这个函数就会进行回调。函数原型必须为 <strong>void XXXX (int,void*);</strong> 如果回调是 NULL 指针，则表示没有回调函数的调用，仅第三个参数 value 有变化。</li><li>void* 类型的 userdata，默认值为 0。这个参数是用户传给回调函数的数据，用来处理轨迹条事件，可忽略。</li></ul><h3 id="获取当前轨迹条的位置gettrackbarpos-函数"><a class="anchor" href="#获取当前轨迹条的位置gettrackbarpos-函数">#</a> <strong>获取当前轨迹条的位置：getTrackbarPos 函数</strong></h3><blockquote><p>int getTrackbarPos(const string&amp; trackbar_name,const string&amp; window_name) ;</p></blockquote><ul><li>const string&amp; 类型的 trackbar_name，轨迹条的名字</li><li>const string&amp; 类型的 window_name，窗口名字</li></ul><h2 id="代码演示-3"><a class="anchor" href="#代码演示-3">#</a> 代码演示</h2><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">nothing</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token keyword">pass</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 创建一个黑色的图像，一个窗口</span></pre></td></tr><tr><td data-num="10"></td><td><pre>img <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>cv<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 创建颜色变化的轨迹栏</span></pre></td></tr><tr><td data-num="13"></td><td><pre>cv<span class="token punctuation">.</span>createTrackbar<span class="token punctuation">(</span><span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> nothing<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>cv<span class="token punctuation">.</span>createTrackbar<span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> nothing<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>cv<span class="token punctuation">.</span>createTrackbar<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> nothing<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 为 ON/OFF 功能创建开关</span></pre></td></tr><tr><td data-num="17"></td><td><pre>switch <span class="token operator">=</span> <span class="token string">'0 : OFF \n1 : ON'</span></pre></td></tr><tr><td data-num="18"></td><td><pre>cv<span class="token punctuation">.</span>createTrackbar<span class="token punctuation">(</span>switch<span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> nothing<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    k <span class="token operator">=</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token comment"># 得到四条轨迹的当前位置</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    r <span class="token operator">=</span> cv<span class="token punctuation">.</span>getTrackbarPos<span class="token punctuation">(</span><span class="token string">'R'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    g <span class="token operator">=</span> cv<span class="token punctuation">.</span>getTrackbarPos<span class="token punctuation">(</span><span class="token string">'G'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    b <span class="token operator">=</span> cv<span class="token punctuation">.</span>getTrackbarPos<span class="token punctuation">(</span><span class="token string">'B'</span><span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    s <span class="token operator">=</span> cv<span class="token punctuation">.</span>getTrackbarPos<span class="token punctuation">(</span>switch<span class="token punctuation">,</span> <span class="token string">'image'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">else</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="33"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120245.png" alt="image-20220830215813213"></p><h2 id="补充知识点"><a class="anchor" href="#补充知识点">#</a> 补充知识点:</h2><p><strong>其中 img [:] 代表:</strong></p><p>opencv 假设图像是 RGB 三分量组成的图像，那么图像的</p><p>第一通道是 R，</p><p>第二通道是 G，</p><p>第三通道是 B</p><p>Img [:,:,2] 代表 R 通道，也就是红色分量图像；</p><p>Img [:,:,1] 代表 G 通道，也就是绿色分量图像；</p><p>Img [:,:,0] 代表 B 通道，也就是蓝色分量图像。</p><p>一、print (img)、print (img [:])、print (img [:, :])</p><p>结果一样，打印图像数组</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120715.png" alt="image-20220830215139124"><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120270.png" alt="image-20220830215212118"><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120687.png" alt="image-20220830215215845"></p><p>print（img) print(img[:]) print(img[:, :])</p><p>二、img [:, 0] 和 img [:, :, 0]、img [:, 1] 和 img [:, :, 1]、img [:, 2] 和 img [:, :, 2]</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120533.png" alt="image-20220830215257896"><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120163.png" alt="image-20220830215315667"></p><p><strong>img[:, 0]</strong> <strong>img[:, :, 0]</strong></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120810.png" alt="image-20220830215350749"><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120574.png" alt="image-20220830215410418"></p><p><strong>img[:, 1]</strong> <strong>img[:, :, 1]</strong></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120984.png" alt="img"><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012120397.png" alt="img"></p><p><strong>img[:, 2]</strong> <strong>img[:, :, 2]</strong></p><p>img [:, 0] /img [:, 1] /img [:, 2]：表示图像列的三通道像素。</p><p>img [:, :, 0] /img [:, :, 1] /img [:, :, 2]：表示图像单个通道的像素。</p><p>原文链接：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTA4ODAzL2FydGljbGUvZGV0YWlscy8xMTY2NzM3OTg=">https://blog.csdn.net/qq_40108803/article/details/116673798</span></p><p>二、图像的 BGR 格式说明</p><pre><code>OpenCV中图像读入的数据格式是numpy的ndarray数据格式。是BGR格式，取值范围是[0,255].
</code></pre><p>如下图所示，分为三个维度：</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209031441092.png" alt="img"></p><p>第一维度：Height 高度，对应图片的 nRow 行数</p><p>第二维度：Width 宽度，对应图片的 nCol 列数</p><p>第三维度：Value 代表 BGR 三通道的值</p><p>BGR 分别代表蓝色，绿色和红色</p><p>2.Image 对象的属性</p><p>image.shape 返回图像的宽度，长度和通道数，如果是灰度图，返回值仅有行数和列数。</p><p>image.size 返回图像的像素</p><p>image.dtype 返回图像的数据类型</p><pre><code>import cv2
img=cv2.imread('1.jpg')
print(&quot;长度:&quot;,img.shape[1],  &quot;宽度:&quot;,img.shape[0], &quot;通道:&quot;, img.shape[2], &quot;像素:&quot;, img.size, &quot;数据类型:&quot;, img.dtype)
</code></pre><p>原文链接：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FpbmdmZW5neGQxL2FydGljbGUvZGV0YWlscy8xMDk0NDkwNDE=">https://blog.csdn.net/qingfengxd1/article/details/109449041</span></p><p>补充其他链接：img [::-1,:,:]、img [:,::-1,:]、img [:,:,::-1] 是啥？——<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTczNTg1OS9hcnRpY2xlL2RldGFpbHMvMTA2NDY4NTUxP3NwbT0xMDAxLjIxMDEuMzAwMS42NjYxLjEmYW1wO3V0bV9tZWRpdW09ZGlzdHJpYnV0ZS5wY19yZWxldmFudF90MC5ub25lLXRhc2stYmxvZy0yJTdFZGVmYXVsdCU3RUNUUkxJU1QlN0VSYXRlLTEtMTA2NDY4NTUxLWJsb2ctNzc5Mjk3MjQucGNfcmVsZXZhbnRfbXVsdGlfcGxhdGZvcm1fd2hpdGVsaXN0djUmYW1wO2RlcHRoXzEtdXRtX3NvdXJjZT1kaXN0cmlidXRlLnBjX3JlbGV2YW50X3QwLm5vbmUtdGFzay1ibG9nLTIlN0VkZWZhdWx0JTdFQ1RSTElTVCU3RVJhdGUtMS0xMDY0Njg1NTEtYmxvZy03NzkyOTcyNC5wY19yZWxldmFudF9tdWx0aV9wbGF0Zm9ybV93aGl0ZWxpc3R2NSZhbXA7dXRtX3JlbGV2YW50X2luZGV4PTE=">https://blog.csdn.net/weixin_41735859/article/details/106468551?spm=1001.2101.3001.6661.1&amp;utm_medium=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-106468551-blog-77929724.pc_relevant_multi_platform_whitelistv5&amp;depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-2~default~CTRLIST~Rate-1-106468551-blog-77929724.pc_relevant_multi_platform_whitelistv5&amp;utm_relevant_index=1</span></p><h1 id="图像的基本操作"><a class="anchor" href="#图像的基本操作">#</a> 图像的基本操作</h1><h2 id="目标-5"><a class="anchor" href="#目标-5">#</a> 目标</h2><p>学会： - 访问像素值并修改它们 - 访问图像属性 - 设置感兴趣区域 (ROI) - 分割和合并图像</p><p>本节中的几乎所有操作都主要与 Numpy 相关，而不是与 OpenCV 相关。要使用 OpenCV 编写更好的优化代码，需要 Numpy 的丰富知识。</p><p><em>（由于大多数示例都是单行代码，因此示例将在 Python 终端中显示）</em></p><h2 id="读取图像"><a class="anchor" href="#读取图像">#</a> 读取图像</h2><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 读取图片</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 后面选项为以什么方式读取图片比如灰色或者彩色或者不改变</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 灰度模式读取，默认为 0</span></pre></td></tr><tr><td data-num="6"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>IMREAD_GRAYSCALE<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 三通道 BGR 模式，默认为 1</span></pre></td></tr><tr><td data-num="8"></td><td><pre>imge <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 不做任何改变，默认为 - 1</span></pre></td></tr><tr><td data-num="10"></td><td><pre>imgee <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>IMREAD_UNCHANGED<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'imagee'</span><span class="token punctuation">,</span> imge<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'imageee'</span><span class="token punctuation">,</span> imgee<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 等待键盘输入</span></pre></td></tr><tr><td data-num="17"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindow<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 销毁所有窗口</span></pre></td></tr></table></figure><p>补充：<img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119348.png" alt="image-20220831155311046"></p><h2 id="访问和修改像素值"><a class="anchor" href="#访问和修改像素值">#</a> 访问和修改像素值</h2><h3 id="普通修改法"><a class="anchor" href="#普通修改法">#</a> 普通修改法</h3><p>你可以通过行和列坐标来访问像素值。对于 BGR 图像，它返回一个由蓝色、绿色和红色值组成的数组。对于灰度图像，只返回相应的灰度。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> px <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> px <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span><span class="token number">157</span> <span class="token number">166</span> <span class="token number">200</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 仅访问蓝色像素</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> blue <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> blue <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">157</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119333.png" alt="image-20220901161100117"></p><p>你可以用相同的方式修改像素值。<img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119767.png" alt="image-20220901161100117"></p><p>或者</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#读写图片</span></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#感兴趣区域 ROI</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment">#类似于切片</span></pre></td></tr><tr><td data-num="8"></td><td><pre>img<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">#其它写法</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#img [10:100, 100:200, 2] = 255   #后面的 2 代表通道一共有三 0~2</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119026.png" alt="image-20220901162015201"></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 以灰度读写图片</span></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#显示指定区域</span></pre></td></tr><tr><td data-num="7"></td><td><pre>img <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token number">200</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119541.png" alt="image-20220901162759984"></p><p><strong>警告</strong></p><p>Numpy 是用于快速数组计算的优化库。因此，简单地访问每个像素值并对其进行修改将非常缓慢，因此不建议使用。</p><blockquote><p><strong>注意</strong> 上面的方法通常用于选择数组的区域，例如前 5 行和后 3 列。对于单个像素访问，Numpy 数组方法 array.item () 和 array.itemset ()) 被认为更好，但是它们始终返回标量。如果要访问所有 B，G，R 值，则需要分别调用所有的 array.item ()。</p></blockquote><p>更好的像素访问和编辑方法：</p><h3 id="numpy数组方法arrayitem和arrayitemset"><a class="anchor" href="#numpy数组方法arrayitem和arrayitemset">#</a> Numpy 数组方法 array.item () 和 array.itemset ())</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> py</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 以灰度读写图片</span></pre></td></tr><tr><td data-num="5"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># numpy 操作像素</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 前两个是像素的坐标，后一个是通道</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 如果是彩色图像通道必须写，灰度图不用写</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 普通方式</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># numpy 方式</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119644.png" alt="image-20220901164225962"></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> py</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 以灰度读写图片</span></pre></td></tr><tr><td data-num="5"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># numpy 操作像素</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 前两个是像素的坐标，后一个是通道</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 如果是彩色图像通道必须写，灰度图不用写</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 普通方式</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># numpy 方式</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#修改像素</span></pre></td></tr><tr><td data-num="16"></td><td><pre>img<span class="token punctuation">.</span>itemset<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>img<span class="token punctuation">.</span>itemset<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>img<span class="token punctuation">.</span>itemset<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">#修改后</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>img<span class="token punctuation">.</span>item<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119857.png" alt="image-20220901164514637"></p><h2 id="访问图像属性"><a class="anchor" href="#访问图像属性">#</a> 访问图像属性</h2><h3 id="图像属性包括行数列数和通道数图像数据类型像素数等"><a class="anchor" href="#图像属性包括行数列数和通道数图像数据类型像素数等">#</a> 图像属性包括行数，列数和通道数，图像数据类型，像素数等。</h3><p>图像的形状可通过 <code>img.shape</code> 访问。它返回行，列和通道数的元组（如果图像是彩色的）：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> img<span class="token punctuation">.</span>shape <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">(</span><span class="token number">342</span><span class="token punctuation">,</span> <span class="token number">548</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># 行数，列数，通道数</span></pre></td></tr></table></figure><p><strong>注意 如果图像是灰度的，则返回的元组仅包含行数和列数，因此这是检查加载的图像是灰度还是彩色的好方法。</strong></p><h3 id="像素总数可通过访问imgsize"><a class="anchor" href="#像素总数可通过访问imgsize">#</a> 像素总数可通过访问 <code>img.size</code> ：</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> img<span class="token punctuation">.</span>size <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">562248</span>  <span class="token comment"># 像素个数   行数 * 列数 * 通道数</span></pre></td></tr></table></figure><h3 id="图像数据类型通过imgdtype获得"><a class="anchor" href="#图像数据类型通过imgdtype获得">#</a> 图像数据类型通过 <code>img.dtype</code> 获得：</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> img<span class="token punctuation">.</span>dtype <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>uint8 <span class="token comment"># 返回数据类型  8 位无符号整数类型  取值范围 0~255</span></pre></td></tr></table></figure><p><em><strong>注意</strong> img.dtype 在调试时非常重要，因为 OpenCV-Python 代码中的大量错误是由无效的数据类型引起的。</em></p><h2 id="图像感兴趣区域roi"><a class="anchor" href="#图像感兴趣区域roi">#</a> 图像感兴趣区域 ROI</h2><p>有时候，你不得不处理一些特定区域的图像。对于图像中的眼睛检测，首先对整个图像进行人脸检测。在获取人脸图像时，我们只选择人脸区域，搜索其中的眼睛，而不是搜索整个图像。它提高了准确性 (因为眼睛总是在面部上：D) 和性能 (因为我们搜索的区域很小)。</p><p>使用 Numpy 索引再次获得 ROI。在这里，我要选择球并将其复制到图像中的另一个区域：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> ball <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token number">280</span><span class="token punctuation">:</span><span class="token number">340</span><span class="token punctuation">,</span> <span class="token number">330</span><span class="token punctuation">:</span><span class="token number">390</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> img<span class="token punctuation">[</span><span class="token number">273</span><span class="token punctuation">:</span><span class="token number">333</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">:</span><span class="token number">160</span><span class="token punctuation">]</span> <span class="token operator">=</span> ball</pre></td></tr></table></figure><p><strong>具体列子可以看上面普通修改法</strong></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119409.png" alt="image-20220901203558959"></p><h2 id="拆分和合并图像通道"><a class="anchor" href="#拆分和合并图像通道">#</a> 拆分和合并图像通道</h2><p>有时你需要分别处理图像的 B，G，R 通道。在这种情况下，你需要将 BGR 图像拆分为单个通道。在其他情况下，你可能需要将这些单独的频道加入 BGR 图片。你可以通过以下方式简单地做到这一点：</p><ol><li><p>方式一:</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 通道拆分</span></pre></td></tr><tr><td data-num="2"></td><td><pre>b <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre>g <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="4"></td><td><pre>r <span class="token operator">=</span> img<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 打印各个通道</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 分别显示通道图片</span></pre></td></tr><tr><td data-num="9"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'pig'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure></li><li><p>方式二:</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r <span class="token operator">=</span> cv2<span class="token punctuation">.</span>split<span class="token punctuation">(</span>img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'pig'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span></pre></td></tr></table></figure><p><strong>警告</strong></p><p><code>cv.split()</code> 是一项耗时的操作（就时间而言）。因此，仅在必要时才这样做。否则请进行 Numpy 索引。</p></li></ol><h2 id="通道合并"><a class="anchor" href="#通道合并">#</a> 通道合并</h2><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 通道合并</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>merge<span class="token punctuation">(</span><span class="token punctuation">[</span>b<span class="token punctuation">,</span> g<span class="token punctuation">,</span> r<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="为图像设置边框填充"><a class="anchor" href="#为图像设置边框填充">#</a> 为图像设置边框（填充）</h2><p>如果要在图像周围创建边框（如相框），则可以使用 <code>cv.copyMakeBorder()</code> 。但是它在卷积运算，零填充等方面有更多应用。此函数采用以下参数：</p><ul><li><strong>src</strong> - 输入图像</li><li><strong>top</strong>，<strong>bottom</strong>，<strong>left</strong>，<strong>right</strong> 边界宽度（以相应方向上的像素数为单位）</li><li><strong>borderType</strong> - 定义要添加哪种边框的标志。它可以是以下类型：</li><li><strong>cv.BORDER_CONSTANT</strong> - 添加恒定的彩色边框。该值应作为下一个参数给出。</li><li><strong>cv.BORDER_REFLECT</strong> - 边框将是边框元素的镜像，如下所示： <em>fedcba | abcdefgh | hgfedcb</em></li><li><strong>cv.BORDER_REFLECT_101</strong> 或 <strong>cv.BORDER_DEFAULT</strong> 与上述相同，但略有变化，例如： <em>gfedcb | abcdefgh | gfedcba</em></li><li><strong>cv.BORDER_REPLICATE</strong> 最后一个元素被复制，像这样： <em>aaaaaa | abcdefgh | hhhhhhh</em></li><li><strong>cv.BORDER_WRAP</strong> 难以解释，它看起来像这样： <em>cdefgh | abcdefgh | abcdefg</em></li><li><strong>value</strong> - 边框的颜色，如果边框类型为<strong> cv.BORDER_CONSTANT</strong></li></ul><p>下面是一个示例代码，演示了所有这些边框类型，以便更好地理解：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="4"></td><td><pre>BLUE <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre>img1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>replicate <span class="token operator">=</span> cv<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>BORDER_REPLICATE<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>reflect <span class="token operator">=</span> cv<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>BORDER_REFLECT<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>reflect101 <span class="token operator">=</span> cv<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>BORDER_REFLECT_101<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>wrap <span class="token operator">=</span> cv<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>BORDER_WRAP<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>constant<span class="token operator">=</span> cv<span class="token punctuation">.</span>copyMakeBorder<span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>BORDER_CONSTANT<span class="token punctuation">,</span>value<span class="token operator">=</span>BLUE<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">231</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img1<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'ORIGINAL'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">232</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>replicate<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'REPLICATE'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">233</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>reflect<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'REFLECT'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">234</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>reflect101<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'REFLECT_101'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">235</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>wrap<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'WRAP'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">236</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>constant<span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'CONSTANT'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>请参阅下面的结果。（图像与 matplotlib 一起显示。因此红色和蓝色通道将互换）：</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209012119094.png" alt="image-20220901211629161"></p><h1 id="图像上的算术运算"><a class="anchor" href="#图像上的算术运算">#</a> 图像上的算术运算</h1><h2 id="目标-6"><a class="anchor" href="#目标-6">#</a> 目标</h2><ul><li>学习图像的几种算术运算，例如加法，减法，按位运算等。</li><li>您将学习以下功能：<strong>cv.add</strong>，<strong>cv.addWeighted</strong> 等。</li></ul><h2 id="图像加法"><a class="anchor" href="#图像加法">#</a> 图像加法</h2><p>您可以通过 OpenCV 函数 <code>cv.add()</code> 或仅通过 numpy 操作 <code>res = img1 + img2</code> 添加两个图像。两个图像应具有相同的深度和类型，或者第二个图像可以只是一个标量值。</p><blockquote><p><strong>注意</strong> OpenCV 加法和 Numpy 加法之间有区别。OpenCV 加法是饱和运算，而 Numpy 加法是模运算。</p></blockquote><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">250</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> cv<span class="token punctuation">.</span>add<span class="token punctuation">(</span>x<span class="token punctuation">,</span>y<span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token comment"># 250+10 = 260 => 255</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> x<span class="token operator">+</span>y <span class="token punctuation">)</span>          <span class="token comment"># 250+10 = 260 % 256 = 4</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>当添加两个图像时，它将更加可见。OpenCV 功能将提供更好的结果。因此，始终最好坚持使用 OpenCV 功能。</p><h2 id="图像融合"><a class="anchor" href="#图像融合">#</a> 图像融合</h2><p>这也是图像加法，但是对图像赋予不同的权重，以使其具有融合或透明的感觉。根据以下等式添加图像：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>G</mi><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mtext>−</mtext><mi>α</mi><mo stretchy="false">)</mo><mi>f</mi><mn>0</mn><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo><mo>+</mo><mi>α</mi><mi>f</mi><mn>1</mn><mo stretchy="false">(</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">G(x)=(1−α)f0(x)+αf1(x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">G</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mord">−</span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mclose">)</span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mord">0</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mord">1</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span></span></p><p>通过从 α 从 0→1 更改，您可以在一个图像到另一个图像之间执行很酷的过渡。</p><p>在这里，我拍摄了两个图像，将它们融合在一起。第一幅图像的权重为 0.7，第二幅图像的权重为 0.3。 <code>cv.addWeighted()</code> 在图像上应用以下公式。</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>d</mi><mi>s</mi><mi>t</mi><mo>=</mo><mi>α</mi><mo>⋅</mo><mi>i</mi><mi>m</mi><mi>g</mi><mn>1</mn><mo>+</mo><mi>β</mi><mo>⋅</mo><mi>i</mi><mi>m</mi><mi>g</mi><mn>2</mn><mo>+</mo><mi>γ</mi></mrow><annotation encoding="application/x-tex">dst=α⋅img1+β⋅img2+γ</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.44445em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:.03588em">g</span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.85396em;vertical-align:-.19444em"></span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal" style="margin-right:.03588em">g</span><span class="mord">2</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.05556em">γ</span></span></span></span></span></p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>在这里，</mtext><mi>γ</mi><mtext>被视为零。</mtext></mrow><annotation encoding="application/x-tex">在这里，γ 被视为零。</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8777699999999999em;vertical-align:-.19444em"></span><span class="mord cjk_fallback">在</span><span class="mord cjk_fallback">这</span><span class="mord cjk_fallback">里</span><span class="mord cjk_fallback">，</span><span class="mord mathnormal" style="margin-right:.05556em">γ</span><span class="mord cjk_fallback">被</span><span class="mord cjk_fallback">视</span><span class="mord cjk_fallback">为</span><span class="mord cjk_fallback">零</span><span class="mord cjk_fallback">。</span></span></span></span></span></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'output.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_REDUCED_COLOR_2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>img2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'heihei.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>img3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'heihei1.png'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>IMREAD_COLOR<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image2'</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image3'</span><span class="token punctuation">,</span> img3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>img4 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>img3<span class="token punctuation">,</span><span class="token number">0.5</span><span class="token punctuation">,</span> img2<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 0.5 为每一幅图像的权重  后面的 0 是 y 增加亮度的（见掩码部分）</span></pre></td></tr><tr><td data-num="12"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image4'</span><span class="token punctuation">,</span> img4<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>cv2<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>cv2<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100658.png" alt="image-20220903161706699"></p><p>注意：<strong>当两幅图片的大小尺寸不相同和通道数不同</strong>就会出现下面这样子的报错</p><p><code>(-209:Sizes of input arguments do not match) The operation is neither 'array op array' (where arrays have the same size and the same number of channels), nor 'array op scalar', nor 'scalar op array' in function 'cv::arithm_op'</code></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100893.png" alt="image-20220903160704774"></p><h2 id="按位运算"><a class="anchor" href="#按位运算">#</a> 按位运算</h2><p>这包括按位 <code>AND</code> 、 <code>OR</code> 、 <code>NOT</code> 和 <code>XOR</code> 操作。它们在提取图像的任何部分 (我们将在后面的章节中看到)、定义和处理非矩形 ROI 等方面非常有用。</p><p><strong>放两张原图：</strong></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100250.jpg" alt="leishengshengzhi"></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100908.jpg" alt="daxiongleisheng"></p><h3 id="按位与运算"><a class="anchor" href="#按位与运算">#</a> 按位与运算</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 按位与运算：任何数 & amp;0=0，1&amp;1=1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#img1 248 11110110</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#img2 48  00110000</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#img  48  00110000</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100041.png" alt="image-20220903191723609"></p><h3 id="按位或运算"><a class="anchor" href="#按位或运算">#</a> 按位或运算</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#按位或运算  有一个为 1 都为 1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_or<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> img3<span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#img1 248 11110110</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#img2 48  00110000</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#img  248 11110110</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100364.png" alt="image-20220903191922407"></p><h3 id="按位非取反"><a class="anchor" href="#按位非取反">#</a> 按位非（取反）</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#按位非 取反</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>img1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>img2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_not<span class="token punctuation">(</span>img1<span class="token operator">&amp;</span>img2<span class="token punctuation">)</span> <span class="token comment">#输出两个取反合并的图像</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 原图</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># img1 248 1111 0110</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># img2 48  0011 0000</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 取反</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># img1 9        1001</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># img2 207 1100 1111</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100355.png" alt="image-20220903193356484"></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100718.png" alt="image-20220903193439534"></p><p>​</p><h3 id="按位异或"><a class="anchor" href="#按位异或">#</a> 按位异或</h3><p><strong>两个相同的值运算结果为 0</strong></p><p><strong>两个不同的值运算结果为 1</strong></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 按位异或</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img5 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_xor<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> img3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#img1 248 11110110</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment">#img2 48  00110000</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#img  198 11000110</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100985.png" alt="image-20220903195140390"></p><h3 id="掩码"><a class="anchor" href="#掩码">#</a> 掩码</h3><p>当使用掩码参数时，操作只在掩码为非 0 的像素点上执行，并将其他像素点的值置 0</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#图一为参数 = 0 时</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> img2<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#图二为参数 = 125 时</span></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>addWeighted<span class="token punctuation">(</span>img1<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> img2<span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">125</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100026.png" alt="image-20220903200602551"></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032100105.png" alt="image-20220903200737768"></p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 利用图片遮盖</span></pre></td></tr><tr><td data-num="2"></td><td><pre>img5 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>bitwise_xor<span class="token punctuation">(</span>img2<span class="token punctuation">,</span> img3<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'imge1'</span><span class="token punctuation">,</span> img5<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> c <span class="token operator">=</span> img1<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="6"></td><td><pre>img5<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>col<span class="token punctuation">]</span> <span class="token operator">=</span>img1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>col<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> img5<span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="加水印"><a class="anchor" href="#加水印">#</a> 加水印</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>img1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'heise.png'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> c <span class="token operator">=</span> img1<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="3"></td><td><pre>mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>add<span class="token punctuation">(</span>img2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>col<span class="token punctuation">]</span><span class="token punctuation">,</span>img1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>col<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>img2<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>col<span class="token punctuation">]</span> <span class="token operator">=</span> mask</pre></td></tr><tr><td data-num="5"></td><td><pre>cv2<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'image'</span><span class="token punctuation">,</span> img2<span class="token punctuation">)</span></pre></td></tr></table></figure><p>水印图</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032140536.png" alt="heise"></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209032140375.png" alt="image-20220903213714755"></p><h1 id="性能衡量和提升技术"><a class="anchor" href="#性能衡量和提升技术">#</a> 性能衡量和提升技术</h1><h2 id="目标-7"><a class="anchor" href="#目标-7">#</a> 目标</h2><p>在图像处理中，由于每秒要处理大量操作，因此必须使代码不仅提供正确的解决方案，而且还必须以最快的方式提供。因此，在本章中，你将学习</p><ul><li>衡量代码的性能。</li><li>一些提高代码性能的技巧。</li><li>你将看到以下功能：<strong>cv.getTickCount</strong>，<strong>cv.getTickFrequency</strong> 等。</li></ul><p>除了 OpenCV，Python 还提供了一个模块<strong> time</strong>，这有助于衡量执行时间。另一个模块<strong> profile</strong> 有助于获取有关代码的详细报告，例如代码中每个函数花费了多少时间，调用了函数的次数等。但是，如果你使用的是 IPython，则所有这些功能都集成在用户友好的界面中方式。我们将看到一些重要的信息，有关更多详细信息，请查看 “** 其他资源”** 部分中的链接。</p><h2 id="使用opencv衡量性能"><a class="anchor" href="#使用opencv衡量性能">#</a> 使用 OpenCV 衡量性能</h2><p><strong>cv.getTickCount</strong> 函数返回从参考事件（如打开机器的那一刻）到调用此函数那一刻之间的时钟周期数。因此，如果在函数执行之前和之后调用它，则会获得用于执行函数的时钟周期数。</p><p><strong>cv.getTickFrequency</strong> 函数返回时钟周期的频率或每秒的时钟周期数。因此，要找到执行时间（以秒为单位），你可以执行以下操作：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>e1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>getTickCount<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 你的执行代码</span></pre></td></tr><tr><td data-num="3"></td><td><pre>e2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>getTickCount<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>time <span class="token operator">=</span> <span class="token punctuation">(</span>e2 <span class="token operator">-</span> e1<span class="token punctuation">)</span><span class="token operator">/</span> cv<span class="token punctuation">.</span>getTickFrequency<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>我们将通过以下示例进行演示。下面的示例应用中位数过滤，其内核的奇数范围为 5 到 49。（不必担心结果会是什么样，这不是我们的目标）：</p><pre><code class="language-PYTHON">img1 = cv.imread('messi5.jpg')
e1 = cv.getTickCount()
for i in range(5,49,2):
    img1 = cv.medianBlur(img1,i)   #模糊处理
e2 = cv.getTickCount()
t = (e2 - e1)/cv.getTickFrequency()
print( t )
# 我得到的结果是0.521107655秒
</code></pre><figure class="highlight handlebars"><figcaption data-lang="handlebars"></figcaption><table><tr><td data-num="1"></td><td><pre>中值滤波</pre></td></tr><tr><td data-num="2"></td><td><pre>medianBlur( InputArray src, OutputArray dst, int ksize );</pre></td></tr></table></figure><p>这里的 src 代表输入图像，dst 代表输出图像，ksize 必须是正数且为奇数<br>该函数使用中值滤波器来平滑图像，可以消除图像中的小点，该值越大，则消除的点越大</p><p><strong>注意</strong> 你可以使用时间模块执行相同的操作。代替 cv.getTickCount，使用 time.time () 函数。然后取两次相差。</p><h2 id="opencv中的默认优化"><a class="anchor" href="#opencv中的默认优化">#</a> OpenCV 中的默认优化</h2><p>许多 OpenCV 函数都是使用 SSE2、 AVX 等进行优化的。 它还包含未优化的代码。因此，如果我们的系统支持这些特性，我们就应该利用它们 (几乎所有现代的处理器都支持它们)。在编译时默认启用它。因此，如果启用了 OpenCV，它将运行优化的代码，否则它将运行未优化的代码。你可以使用 <strong>cvUseoptimized</strong> 检查是否启用 / 禁用和 <strong>cvSetuseoptimized</strong> 以启用 / 禁用它。让我们看一个简单的例子。</p><pre><code># 检查是否启用了优化
In [5]: cv.useOptimized()
Out[5]: True
In [6]: %timeit res = cv.medianBlur(img,49)
10 loops, best of 3: 34.9 ms per loop
# 关闭它
In [7]: cv.setUseOptimized(False)
In [8]: cv.useOptimized()
Out[8]: False
In [9]: %timeit res = cv.medianBlur(img,49)
10 loops, best of 3: 64.1 ms per loop
</code></pre><p>看，优化的中值滤波比未优化的版本快 2 倍。如果你检查其来源，你可以看到中值滤波是 SIMD 优化。因此，你可以使用它在代码顶部启用优化 (请记住，它是默认启用的)</p><h2 id="在ipython中衡量性能"><a class="anchor" href="#在ipython中衡量性能">#</a> 在 IPython 中衡量性能</h2><p>有时你可能需要比较两个类似操作的性能。IPython 为你提供了一个神奇的命令计时器来执行此操作。它会多次运行代码以获得更准确的结果。同样，它们适用于测量单行代码。</p><p>例如，你知道以下哪个加法运算更好， <code>x = 5; y = x**2, x = 5; y = x*x, x = np.uint8([5]); y = x*x</code> 或 <code>y = np.square(x)</code> ? 我们将在 IPython shell 中使用 timeit 得到答案。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">:</span> x <span class="token operator">=</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>测时 y<span class="token operator">=</span>x<span class="token operator">**</span><span class="token number">2</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">73</span> ns per loop</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>测时 y<span class="token operator">=</span>x<span class="token operator">*</span>x</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">10000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">58.3</span> ns per loop</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">15</span><span class="token punctuation">]</span><span class="token punctuation">:</span> z <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">17</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>测时 y<span class="token operator">=</span>z<span class="token operator">*</span>z</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">1.25</span> us per loop</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">19</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>测时 y<span class="token operator">=</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>z<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">1000000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">1.16</span> us per loop</pre></td></tr></table></figure><p>你可以看到 x = 5; y = x * x 最快，比 Numpy 快 20 倍左右。如果你还考虑阵列的创建，它可能会快 100 倍。酷吧？<em>（大量开发人员正在研究此问题）</em></p><blockquote><p>注意 Python 标量操作比 Numpy 标量操作快。因此，对于包含一两个元素的运算，Python 标量比 Numpy 数组好。当数组大小稍大时，Numpy 会占优势。</p></blockquote><p>我们将再尝试一个示例。这次，我们将比较<strong> cv.countNonZero</strong> 和<strong> np.count_nonzero</strong> 对于同一张图片的性能。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">35</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>测时 z <span class="token operator">=</span> cv<span class="token punctuation">.</span>countNonZero<span class="token punctuation">(</span>img<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">100000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">15.8</span> us per loop</pre></td></tr><tr><td data-num="3"></td><td><pre>In <span class="token punctuation">[</span><span class="token number">36</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>测时 z <span class="token operator">=</span> np<span class="token punctuation">.</span>count_nonzero<span class="token punctuation">(</span>img<span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">1000</span> loops<span class="token punctuation">,</span> best of <span class="token number">3</span><span class="token punctuation">:</span> <span class="token number">370</span> us per loop</pre></td></tr></table></figure><p>看，OpenCV 函数比 Numpy 函数快近 25 倍。</p><blockquote><p><strong>注意</strong> 通常，OpenCV 函数比 Numpy 函数要快。因此，对于相同的操作，首选 OpenCV 功能。但是，可能会有例外，尤其是当 Numpy 处理视图而不是副本时。</p><h3 id="性能优化技术"><a class="anchor" href="#性能优化技术">#</a> 性能优化技术</h3><p>有几种技术和编码方法可以充分利用 Python 和 Numpy 的最大性能。这里只注明相关信息，并提供重要信息来源的链接。这里要注意的主要事情是，首先尝试以一种简单的方式实现算法。一旦它运行起来，分析它，找到瓶颈并优化它们。</p><ol><li>尽量避免在 Python 中使用循环，尤其是双 / 三重循环等。它们本来就很慢。</li><li>由于 Numpy 和 OpenCV 已针对向量运算进行了优化，因此将算法 / 代码向量化到最大程度。</li><li>利用缓存一致性。</li><li>除非需要，否则切勿创建数组的副本。尝试改用视图。数组复制是一项昂贵的操作。</li></ol><p>即使执行了所有这些操作后，如果你的代码仍然很慢，或者不可避免地需要使用大循环，请使用 Cython 等其他库来使其更快。</p><h3 id="其他资源"><a class="anchor" href="#其他资源">#</a> 其他资源</h3><ol><li>Python 优化技术：<span class="exturl" data-url="aHR0cDovL3dpa2kucHl0aG9uLm9yZy9tb2luL1B5dGhvblNwZWVkL1BlcmZvcm1hbmNlVGlwcw==">http://wiki.python.org/moin/PythonSpeed/PerformanceTips</span></li><li>Scipy 讲义 - 高级 Numpy：<span class="exturl" data-url="aHR0cDovL3NjaXB5LWxlY3R1cmVzLmdpdGh1Yi5pby9hZHZhbmNlZC9hZHZhbmNlZF9udW1weS9pbmRleC5odG1sI2FkdmFuY2VkLW51bXB5">http://scipy-lectures.github.io/advanced/advanced_numpy/index.html#advanced-numpy</span></li><li>IPython 中的时序和性能分析：<span class="exturl" data-url="aHR0cDovL3B5bmFzaC5vcmcvMjAxMy8wMy8wNi90aW1pbmctYW5kLXByb2ZpbGluZy8=">http://pynash.org/2013/03/06/timing-and-profiling/</span></li></ol></blockquote><h1 id="改变颜色空间"><a class="anchor" href="#改变颜色空间">#</a> 改变颜色空间</h1><h2 id="目标-8"><a class="anchor" href="#目标-8">#</a> 目标</h2><ul><li>在本教程中，你将学习如何将图像从一个色彩空间转换到另一个，像 BGR↔灰色，BGR↔HSV 等</li><li>除此之外，我们还将创建一个应用程序，以提取视频中的彩色对象</li><li>你将学习以下功能：<strong>cv.cvtColor</strong>，<strong>cv.inRange</strong> 等。</li></ul><p>OpenCV 中有超过 150 种颜色空间转换方法。但是我们将研究只有两个最广泛使用的，<strong>BGR↔灰色和 BGR↔HSV</strong>。</p><p>对于颜色转换，我们使用 cv 函数。cvtColor (input_image, flag)，其中 flag 决定转换的类型。</p><p>对于 BGR→灰度转换，我们使用标志 cv.COLOR_BGR2GRAY。类似地，对于 BGR→HSV，我们使用标志 cv.COLOR_BGR2HSV。要获取其他标记，只需在 Python 终端中运行以下命令:</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> flags <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">dir</span><span class="token punctuation">(</span>cv<span class="token punctuation">)</span> <span class="token keyword">if</span> i<span class="token punctuation">.</span>startswith<span class="token punctuation">(</span><span class="token string">'COLOR_'</span><span class="token punctuation">)</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> flags <span class="token punctuation">)</span></pre></td></tr></table></figure><blockquote><p><strong>注意</strong> HSV 的色相范围为 [0,179]，饱和度范围为 [0,255]，值范围为 [0,255]。不同的软件使用不同的规模。因此，如果你要将 OpenCV 值和它们比较，你需要将这些范围标准化。</p></blockquote><h2 id="对象追踪"><a class="anchor" href="#对象追踪">#</a> 对象追踪</h2><p>现在我们知道了如何将 BGR 图像转换成 HSV，我们可以使用它来提取一个有颜色的对象。在 HSV 中比在 BGR 颜色空间中更容易表示颜色。在我们的应用程序中，我们将尝试提取一个蓝色的对象。方法如下: - 取视频的每一帧 - 转换从 BGR 到 HSV 颜色空间 - 我们对 HSV 图像设置蓝色范围的阈值 - 现在单独提取蓝色对象，我们可以对图像做任何我们想做的事情。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">video</span><span class="token punctuation">(</span>windows<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    cv<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span>windows<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    cv2<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>windows<span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>cap <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token string">'E:/python/deeplearn/video001.mp4'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment"># 读取帧</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    _<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token comment"># 转换颜色空间 BGR 到 HSV</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    hsv <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment"># 定义 HSV 中蓝色的范围</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    lower_blue <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    upper_blue <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment"># 设置 HSV 的阈值使得只取蓝色</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    mask <span class="token operator">=</span> cv<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> lower_blue<span class="token punctuation">,</span> upper_blue<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token comment"># 将掩膜和图像逐像素相加</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    res <span class="token operator">=</span> cv<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> frame<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    video<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    video<span class="token punctuation">(</span><span class="token string">'mask'</span><span class="token punctuation">,</span> mask<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    video<span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    k <span class="token operator">=</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="29"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="cv2inrange函数"><a class="anchor" href="#cv2inrange函数">#</a> cv2.inRange 函数</h3><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>mask <span class="token operator">=</span> cv2<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> lower_red<span class="token punctuation">,</span> upper_red<span class="token punctuation">)</span> <span class="token comment">#lower20===>0,upper200==>0,</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#第一个参数：hsv 指的是原图</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#第二个参数：lower_red 指的是图像中低于这个 lower_red 的值，图像值变为 0</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#第三个参数：upper_red 指的是图像中高于这个 upper_red 的值，图像值变为 0</span></pre></td></tr></table></figure><h3 id="cvbitwise_and函数"><a class="anchor" href="#cvbitwise_and函数">#</a> cv.bitwise_and 函数</h3><p>1.RGB 图像选取掩膜选定的区域</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>iamge<span class="token punctuation">,</span>image<span class="token punctuation">,</span>mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#这里的两个 iamge 就是一样的</span></pre></td></tr></table></figure><p>2. 求两张图片的交集</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>cv2<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>iamge1<span class="token punctuation">,</span>image2<span class="token punctuation">,</span>mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">#这里相当于找相同，两张图片，重合寻找相同点</span></pre></td></tr></table></figure><p>详细参考：<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1a2FzX3Rlbi9hcnRpY2xlL2RldGFpbHMvMTE1MTQ5MDg2">https://blog.csdn.net/lukas_ten/article/details/115149086</span></p><p><strong>注意</strong> 图像中有一些噪点。我们将在后面的章节中看到如何删除它们。 这是对象跟踪中最简单的方法。一旦学习了轮廓的功能，你就可以做很多事情，例如找到该对象的质心并使用它来跟踪对象，仅通过将手移到相机前面以及其他许多有趣的东西就可以绘制图表。</p><h2 id="如何找到要追踪的hsv值"><a class="anchor" href="#如何找到要追踪的hsv值">#</a> 如何找到要追踪的 HSV 值？</h2><p>它非常简单，你可以使用相同的函数<strong> cv.cvtColor ()</strong>。你只需传递你想要的 BGR 值，而不是传递图像。例如，要查找绿色的 HSV 值，请在 Python 终端中尝试以下命令:</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> green <span class="token operator">=</span> np<span class="token punctuation">.</span>uint8<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span><span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> hsv_green <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>green<span class="token punctuation">,</span>cv<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">print</span><span class="token punctuation">(</span> hsv_green <span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">60</span> <span class="token number">255</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>现在把 <code>[H- 10,100,100]</code> 和 <code>[H+ 10,255, 255]</code> 分别作为下界和上界。除了这个方法之外，你可以使用任何图像编辑工具 (如 GIMP 或任何在线转换器) 来查找这些值，但是不要忘记调整 HSV 范围。</p><h3 id="练习题"><a class="anchor" href="#练习题">#</a> 练习题</h3><ol><li><p>尝试找到一种方法来提取多个彩色对象，例如，同时提取红色，蓝色，绿色对象。</p></li><li><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">def</span> <span class="token function">video</span><span class="token punctuation">(</span>windows<span class="token punctuation">,</span> img<span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    cv<span class="token punctuation">.</span>namedWindow<span class="token punctuation">(</span>windows<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>WINDOW_NORMAL<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>windows<span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>cap <span class="token operator">=</span> cv<span class="token punctuation">.</span>VideoCapture<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># cap = cv.VideoCapture('E:/python/deeplearn/video001.mp4')</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment"># 读取帧</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    _<span class="token punctuation">,</span> frame <span class="token operator">=</span> cap<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment"># 转换颜色空间 BGR 到 HSV</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    hsv <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2HSV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token comment"># 定义 HSV 中蓝色的范围</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    lower_blue <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">106</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    upper_blue <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">130</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment"># 定义 HSV 中绿色的范围</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    lower_green <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    upper_green <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">80</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token comment"># 定义 HSV 中红色的范围</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    lower_red <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    upper_red <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment"># 定义 HSV 中蓝色的范围</span></pre></td></tr><tr><td data-num="27"></td><td><pre>    lower_red1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">150</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    upper_red1 <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">180</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token comment"># 设置 HSV 的阈值使得只取红绿蓝</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    mask_blue <span class="token operator">=</span> cv<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> lower_blue<span class="token punctuation">,</span> upper_blue<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    mask_green <span class="token operator">=</span> cv<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> lower_green<span class="token punctuation">,</span> upper_green<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    mask_red <span class="token operator">=</span> cv<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> lower_red<span class="token punctuation">,</span> upper_red<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    mask_red1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>inRange<span class="token punctuation">(</span>hsv<span class="token punctuation">,</span> lower_red1<span class="token punctuation">,</span> upper_red1<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    mask <span class="token operator">=</span> mask_red <span class="token operator">+</span> mask_red1 <span class="token operator">+</span> mask_blue <span class="token operator">+</span> mask_green</pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token comment"># 将掩膜和图像逐像素相加</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    res <span class="token operator">=</span> cv<span class="token punctuation">.</span>bitwise_and<span class="token punctuation">(</span>frame<span class="token punctuation">,</span> frame<span class="token punctuation">,</span> mask<span class="token operator">=</span>mask<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    video<span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">,</span> frame<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>    video<span class="token punctuation">(</span><span class="token string">'mask'</span><span class="token punctuation">,</span> mask<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    video<span class="token punctuation">(</span><span class="token string">'res'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    k <span class="token operator">=</span> cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token number">0xFF</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token keyword">if</span> k <span class="token operator">==</span> <span class="token number">27</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token keyword">break</span></pre></td></tr><tr><td data-num="44"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209071652006.png" alt="image-20220907162551062"></p></li></ol><h1 id="图像的几何变换"><a class="anchor" href="#图像的几何变换">#</a> 图像的几何变换</h1><h2 id="目标-9"><a class="anchor" href="#目标-9">#</a> 目标</h2><ul><li>学习将不同的几何变换应用到图像上，如平移、旋转、仿射变换等。</li><li>你会看到这些函数: <strong>cv.getPerspectiveTransform</strong></li></ul><h2 id="变换"><a class="anchor" href="#变换">#</a> 变换</h2><p>OpenCV 提供了两个转换函数<strong> cv.warpAffine</strong> 和<strong> cv.warpPerspective</strong>，您可以使用它们进行各种转换。<strong>cv.warpAffine</strong> 采用 2x3 转换矩阵，而<strong> cv.warpPerspective</strong> 采用 3x3 转换矩阵作为输入。</p><h2 id="缩放"><a class="anchor" href="#缩放">#</a> 缩放</h2><p>缩放只是调整图像的大小。为此，OpenCV 带有一个函数<strong> cv.resize ()</strong>。图像的大小可以手动指定，也可以指定缩放比例。也可使用不同的插值方法。首选的插值方法是 **cv.INTER_AREA*<em> 用于缩小，*<em>cv.INTER_CUBIC</em></em>（慢）和<strong> cv.INTER_LINEAR</strong> 用于缩放。默认情况下，出于所有调整大小的目的，使用的插值方法为<strong> cv.INTER_LINEAR</strong>。您可以使用以下方法调整输入图像的大小：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>dst <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>src<span class="token punctuation">,</span> dsize<span class="token punctuation">[</span><span class="token punctuation">,</span> dst<span class="token punctuation">[</span><span class="token punctuation">,</span> fx<span class="token punctuation">[</span><span class="token punctuation">,</span> fy<span class="token punctuation">[</span><span class="token punctuation">,</span> interpolation<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr></table></figure><table><thead><tr><th style="text-align:center">参数</th><th style="text-align:center">类型</th><th style="text-align:center">是否必须指定</th><th style="text-align:center">具体含义</th></tr></thead><tbody><tr><td style="text-align:center">src</td><td style="text-align:center">numpy.ndarray</td><td style="text-align:center">是</td><td style="text-align:center">原图像</td></tr><tr><td style="text-align:center">dsize</td><td style="text-align:center">tuple&lt;int&gt;</td><td style="text-align:center">是</td><td style="text-align:center">缩放后的图像大小</td></tr><tr><td style="text-align:center">dst</td><td style="text-align:center">无所谓</td><td style="text-align:center">否</td><td style="text-align:center">目标图像，但是在 Python 里面没有任何意义。一般不传参或者设成 None</td></tr><tr><td style="text-align:center">fx, fy</td><td style="text-align:center">数值类型</td><td style="text-align:center">否</td><td style="text-align:center">x 和 y 方向上的缩放比例</td></tr><tr><td style="text-align:center">interpolation</td><td style="text-align:center">int</td><td style="text-align:center">否</td><td style="text-align:center">插值方式表示代码，本质是一个 int 数值，一般用 OpenCV 内置的参数代号以提高可读性</td></tr></tbody></table><h3 id="插入方式"><a class="anchor" href="#插入方式">#</a> 插入方式：</h3><table><thead><tr><th style="text-align:center">INTER_NEAREST</th><th style="text-align:center">最近邻插值</th></tr></thead><tbody><tr><td style="text-align:center"><strong>INTER_LINEAR</strong></td><td style="text-align:center"><strong>双线性插值（默认设置）。放大图片用这个，速度快。效果也不错。</strong></td></tr><tr><td style="text-align:center"><strong>INTER_AREA</strong></td><td style="text-align:center"><strong>使用像素区域关系进行重采样。缩小图片用这个效果最好</strong></td></tr><tr><td style="text-align:center"><strong>INTER_CUBIC</strong></td><td style="text-align:center"><strong>4x4 像素邻域的双三次插值。放大图片用这个，速度慢。</strong></td></tr><tr><td style="text-align:center"><strong>INTER_LANCZOS4</strong></td><td style="text-align:center"><strong>8x8 像素邻域的 Lanczos 插值</strong></td></tr></tbody></table><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'daxiongleisheng.jpg'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>res <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> fx<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> fy<span class="token operator">=</span><span class="token number">0.2</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv<span class="token punctuation">.</span>INTER_CUBIC<span class="token punctuation">)</span> <span class="token comment">#fx 和 fy 大于 1 放大小于 1 缩小</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># cv.namedWindow('img1', cv.WINDOW_NORMAL)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img1'</span><span class="token punctuation">,</span> res<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img2'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>或者</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>height<span class="token punctuation">,</span> width <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token comment">#将图像的行和列像素赋值给 height 和 width</span></pre></td></tr><tr><td data-num="2"></td><td><pre>res1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>width<span class="token punctuation">,</span> <span class="token number">2</span><span class="token operator">*</span>height<span class="token punctuation">)</span><span class="token punctuation">,</span> interpolation<span class="token operator">=</span>cv<span class="token punctuation">.</span>INTER_CUBIC<span class="token punctuation">)</span>   放大就将像素乘以大于一的数，缩小就乘以小于一的数</pre></td></tr></table></figure><h2 id="平移"><a class="anchor" href="#平移">#</a> 平移</h2><p>平移是物体位置的移动。如果您知道在 (x,y) 方向上的位移，则将其设为 (tx</p><p>,ty)，你可以创建转换矩阵 M</p><p>，如下所示：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>t</mi><mi>x</mi></msub></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>0</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mn>1</mn></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><msub><mi>t</mi><mi>y</mi></msub></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M = \begin{bmatrix} 1 &amp; 0 &amp; t_x \\ 0 &amp; 1 &amp; t_y \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-.95003em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">0</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.151392em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">x</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>您可以将其放入<strong> np.float32</strong> 类型的 Numpy 数组中，并将其传递给<strong> cv.warpAffine</strong> 函数。参见下面偏移为 (100, 50) 的示例：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'daxiongleisheng.jpg'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment"># 以灰度图像读取，行和列</span></pre></td></tr><tr><td data-num="5"></td><td><pre>rows<span class="token punctuation">,</span> cols<span class="token punctuation">,</span> t <span class="token operator">=</span> img<span class="token punctuation">.</span>shape  <span class="token comment"># 将行和列分别赋值给 rows，clos</span></pre></td></tr><tr><td data-num="6"></td><td><pre>M <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># 沿 x 轴向右平移 100，沿 y 轴向下平移 50 </span></pre></td></tr><tr><td data-num="7"></td><td><pre>dst <span class="token operator">=</span> cv<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span>M<span class="token punctuation">,</span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span>dst<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211807755.png" alt="image-20220918155625067"></p><h3 id="警告"><a class="anchor" href="#警告">#</a> <strong>警告</strong></h3><p><strong>cv.warpAffine</strong> 函数的第三个参数是输出图像的大小，其形式应为 <code>(width，height)</code> 。记住 <code>width</code> = 列数， <code>height</code> = 行数。</p><h2 id="旋转"><a class="anchor" href="#旋转">#</a> 旋转</h2><p>图像旋转角度为 θ 是通过以下形式的变换矩阵实现的：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>s</mi><mi>i</mi><mi>n</mi><mi>θ</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>c</mi><mi>o</mi><mi>s</mi><mi>θ</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mrow><annotation encoding="application/x-tex">M = \begin{bmatrix} cos\theta &amp; -sin\theta \\ sin\theta &amp; cos\theta \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-.95003em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="mord mathnormal">o</span><span class="mord mathnormal">s</span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>但是 OpenCV 提供了可缩放的旋转以及可调整的旋转中心，因此您可以在自己喜欢的任何位置旋转。修改后的变换矩阵为</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo fence="true">[</mo><mtable rowspacing="0.15999999999999992em" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>α</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>β</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo>−</mo><mi>β</mi><mo>⋅</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>−</mo><mi>β</mi></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mi>α</mi></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>β</mi><mo>⋅</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>x</mi><mo>+</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>c</mi><mi>e</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi mathvariant="normal">.</mi><mi>y</mi></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><annotation encoding="application/x-tex">\begin{bmatrix} \alpha &amp; \beta &amp; (1- \alpha ) \cdot center.x - \beta \cdot center.y \\ - \beta &amp; \alpha &amp; \beta \cdot center.x + (1- \alpha ) \cdot center.y \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.40003em;vertical-align:-.95003em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size3">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.0037em">α</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord">−</span><span class="mord mathnormal" style="margin-right:.05278em">β</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05278em">β</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.0037em">α</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span><span class="arraycolsep" style="width:.5em"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:.03588em">y</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord">.</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mord mathnormal">c</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord">.</span><span class="mord mathnormal" style="margin-right:.03588em">y</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span></span></span><span class="mclose delimcenter" style="top:0"><span class="delimsizing size3">]</span></span></span></span></span></span></span></p><p>其中：</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mtable rowspacing="0.15999999999999992em" columnalign="left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>α</mi><mo>=</mo><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi><mo>⋅</mo><mi>cos</mi><mo>⁡</mo><mi>θ</mi><mo separator="true">,</mo></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>β</mi><mo>=</mo><mi>s</mi><mi>c</mi><mi>a</mi><mi>l</mi><mi>e</mi><mo>⋅</mo><mi>sin</mi><mo>⁡</mo><mi>θ</mi></mrow></mstyle></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{array}{l} \alpha = scale \cdot \cos \theta , \\ \beta = scale \cdot \sin \theta \end{array}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:2.4000000000000004em;vertical-align:-.9500000000000004em"></span><span class="mord"><span class="mtable"><span class="arraycolsep" style="width:.5em"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.45em"><span style="top:-3.61em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.0037em">α</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mop">cos</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span><span class="mpunct">,</span></span></span><span style="top:-2.4099999999999997em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.05278em">β</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:.01968em">l</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mop">sin</span><span class="mspace" style="margin-right:.16666666666666666em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.9500000000000004em"><span></span></span></span></span></span><span class="arraycolsep" style="width:.5em"></span></span></span></span></span></span></span></p><p>为了找到此转换矩阵，OpenCV 提供了一个函数<strong> cv.getRotationMatrix2D</strong>。请检查以下示例，该示例将图像相对于中心旋转 90 度而没有任何缩放比例。</p><pre><code class="language-PYTHON">img = cv.imread('daxiongleisheng.jpg', 1)
rows, cols, r = img.shape
# cols-1 和 rows-1 是坐标限制
M = cv.getRotationMatrix2D(((cols - 1) / 2.0, (rows - 1) / 2.0), 90, 1)  #((cols - 1) / 2.0, (rows - 1) / 2.0)寻找图片的中心
dst = cv.warpAffine(img, M, (cols, rows))
cv.namedWindow('img', cv.WINDOW_NORMAL)
cv.imshow('img', dst)
cv.waitKey(0)
cv.destroyAllWindows()

&quot;&quot;&quot;
cv.destroyAllWindows(center, angle, scale)
center: 旋转的中心点
angle:  旋转的角度 正逆时针 负顺时针
scale:  缩放倍数 大于1放大 小于1缩小 
&quot;&quot;&quot;
</code></pre><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211807843.png" alt="image-20220918161232823"></p><h2 id="仿射变换"><a class="anchor" href="#仿射变换">#</a> 仿射变换</h2><p>在仿射变换中，原始图像中的所有平行线在输出图像中仍将平行。为了找到变换矩阵，我们需要输入图像中的三个点及其在输出图像中的对应位置。然后<strong> cv.getAffineTransform</strong> 将创建一个 2x3 矩阵，该矩阵将传递给<strong> cv.warpAffine</strong>。</p><p>查看以下示例，并查看我选择的点（以绿色标记）：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'drawing.png'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>rows<span class="token punctuation">,</span>cols<span class="token punctuation">,</span>ch <span class="token operator">=</span> img<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="3"></td><td><pre>pts1 <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>pts2 <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">250</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>M <span class="token operator">=</span> cv<span class="token punctuation">.</span>getAffineTransform<span class="token punctuation">(</span>pts1<span class="token punctuation">,</span>pts2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>dst <span class="token operator">=</span> cv<span class="token punctuation">.</span>warpAffine<span class="token punctuation">(</span>img<span class="token punctuation">,</span>M<span class="token punctuation">,</span><span class="token punctuation">(</span>cols<span class="token punctuation">,</span>rows<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Input'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Output'</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="透视变换"><a class="anchor" href="#透视变换">#</a> 透视变换</h2><p>对于透视变换，您需要 3x3 变换矩阵。即使在转换后，直线也将保持直线。要找到此变换矩阵，您需要在输入图像上有 4 个点，在输出图像上需要相应的点。在这四个点中，其中三个不应共线。然后可以通过函数<strong> cv.getPerspectiveTransform</strong> 找到变换矩阵。然后将<strong> cv.warpPerspective</strong> 应用于此 3x3 转换矩阵。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'sudoku.png'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre>rows<span class="token punctuation">,</span>cols<span class="token punctuation">,</span>ch <span class="token operator">=</span> img<span class="token punctuation">.</span>shape</pre></td></tr><tr><td data-num="3"></td><td><pre>pts1 <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">56</span><span class="token punctuation">,</span><span class="token number">65</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">368</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">28</span><span class="token punctuation">,</span><span class="token number">387</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">389</span><span class="token punctuation">,</span><span class="token number">390</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>pts2 <span class="token operator">=</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>M <span class="token operator">=</span> cv<span class="token punctuation">.</span>getPerspectiveTransform<span class="token punctuation">(</span>pts1<span class="token punctuation">,</span>pts2<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>dst <span class="token operator">=</span> cv<span class="token punctuation">.</span>warpPerspective<span class="token punctuation">(</span>img<span class="token punctuation">,</span>M<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span><span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Input'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>dst<span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Output'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="上面两个还没有弄懂以后在说"><a class="anchor" href="#上面两个还没有弄懂以后在说">#</a> 上面两个还没有弄懂，以后在说！！！</h2><h1 id="图像阈值"><a class="anchor" href="#图像阈值">#</a> 图像阈值</h1><h2 id="目标-10"><a class="anchor" href="#目标-10">#</a> 目标</h2><ul><li>在本教程中，您将学习简单阈值，自适应阈值和 Otsu 阈值。</li><li>你将学习函数<strong> cv.threshold</strong> 和<strong> cv.adaptiveThreshold</strong>。</li></ul><h2 id="简单阈值"><a class="anchor" href="#简单阈值">#</a> 简单阈值</h2><p>在这里，问题直截了当。对于每个像素，应用相同的阈值。如果像素值小于阈值，则将其设置为 0，否则将其设置为最大值。函数<strong> cv.threshold</strong> 用于应用阈值。第一个参数是源图像，它<strong>应该是灰度图像</strong>。第二个参数是阈值，用于对像素值进行分类。第三个参数是分配给超过阈值的像素值的最大值。OpenCV 提供了不同类型的阈值，这由函数的第四个参数给出。通过使用<strong> cv.THRESH_BINARY</strong> 类型。所有简单的阈值类型为：</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211807241.png" alt="image-20220921152804246"></p><p>``` 参数： <code></code> 第一个：老规律了，首先就是你搞搞事情的对象，你要搞谁，搞哪张图片。 <code></code> 第二个：阈值，threshold，告诉函数门槛是什么。 <code></code> 第三个：最大值，有可能会用到的值，取决于你后面选取的 type，maxval = max value。`<br>第四个：type，怎么搞事情，搞事情的方法。``</p><ul><li><p><strong>cv.THRESH_BINARY</strong> 二进制阈值化</p></li><li><p>**cv.THRESH_BINARY_INV ** 反二进制阈值化</p></li><li><p><strong>cv.THRESH_TRUNC</strong> 截断阈值化</p></li><li><p><strong>cv.THRESH_TOZERO</strong> 阈值化为 0</p></li><li><p>**cv.THRESH_TOZERO_INV ** 反阈值化为 0</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211808242.png" alt="image-20220921152901453"></p></li></ul><p>请通过类型的文档来观察区别。</p><p>该方法返回两个输出。第一个是使用的阈值，第二个输出是<strong>阈值后的图像</strong>。</p><p>此代码比较了不同的简单阈值类型：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'daxiongleisheng.jpg'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>ret<span class="token punctuation">,</span> thresh1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>ret<span class="token punctuation">,</span> thresh2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>THRESH_BINARY_INV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>ret<span class="token punctuation">,</span> thresh3 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>THRESH_TRUNC<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>ret<span class="token punctuation">,</span> thresh4 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>THRESH_TOZERO<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>ret<span class="token punctuation">,</span> thresh5 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv<span class="token punctuation">.</span>THRESH_TOZERO_INV<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span> <span class="token string">'BINARY'</span><span class="token punctuation">,</span> <span class="token string">'BINARY_INV'</span><span class="token punctuation">,</span> <span class="token string">'TRUNC'</span><span class="token punctuation">,</span> <span class="token string">'TOZERO'</span><span class="token punctuation">,</span> <span class="token string">'TOZERO_INV'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>images <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">,</span> thresh1<span class="token punctuation">,</span> thresh2<span class="token punctuation">,</span> thresh3<span class="token punctuation">,</span> thresh4<span class="token punctuation">,</span> thresh5<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'gray'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211808306.png" alt="image-20220921153345149"></p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211808386.png" alt="image-20220921153458680"></p><h2 id="自适应阈值"><a class="anchor" href="#自适应阈值">#</a> 自适应阈值</h2><p>在上一节中，我们使用一个全局值作为阈值。但这可能并非在所有情况下都很好，例如，如果图像在不同区域具有不同的光照条件。在这种情况下，自适应阈值阈值化可以提供帮助。在此，算法基于像素周围的小区域确定像素的阈值。因此，对于同一图像的不同区域，我们获得了不同的阈值，这为光照度变化的图像提供了更好的结果。</p><p>除上述参数外，方法<strong> cv.adaptiveThreshold</strong> 还包含三个输入参数：</p><p><code>dst = cv2.adaptiveThreshold(src, maxval, thresh_type, type, Block Size, C)</code></p><ul><li>src： 输入图，只能输入单通道图像，通常来说为灰度图</li><li>dst： 输出图</li><li>maxval： 当像素值超过了阈值（或者小于阈值，根据 type 来决定），所赋予的值</li><li>thresh_type： 阈值的计算方法，包含以下 2 种类型：</li></ul><table><thead><tr><th>thresh_type</th><th>含义</th></tr></thead><tbody><tr><td>cv2.ADPTIVE_THRESH_MEAN_C</td><td>阈值取自相邻区域的平均值</td></tr><tr><td>cv2.ADPTIVE_THRESH_GAUSSIAN_C</td><td>阈值取值相邻区域的加权和，权重为一个高斯窗口。</td></tr></tbody></table><ul><li>type：二值化操作的类型，与固定阈值函数相同，包含以下 5 种类型：</li></ul><table><thead><tr><th>type</th><th>含义</th></tr></thead><tbody><tr><td>cv2.THRESH_BINARY</td><td>超过阈值部分取 maxval（最大值），否则取 0</td></tr><tr><td>cv2.THRESH_BINARY_INV</td><td>THRESH_BINARY 的反转</td></tr><tr><td>cv2.THRESH_TRUNC</td><td>大于阈值部分设为阈值，否则不变</td></tr><tr><td>cv2.THRESH_TOZERO</td><td>大于阈值部分不改变，否则设为 0</td></tr><tr><td>cv2.THRESH_TOZERO_INV</td><td>THRESH_TOZERO 的反转</td></tr></tbody></table><ul><li>Block Size： 邻域大小（用来计算阈值的区域大小）</li><li>C ：阈值计算方法中的常数项，通过上述两种方法计算好的阈值最终会减去这个常数</li></ul><p>该<strong> adaptiveMethod</strong> 决定阈值是如何计算的：</p><p><strong>cv.ADAPTIVE_THRESH_MEAN_C:</strong>: 阈值是邻近区域的平均值减去常数<strong> C</strong>。</p><p><strong>cv.ADAPTIVE_THRESH_GAUSSIAN_C</strong>: 阈值是邻域值的高斯加权总和减去常数<strong> C</strong>。</p><p>该<strong> BLOCKSIZE</strong> 确定附近区域的大小，<strong>C</strong> 是从邻域像素的平均或加权总和中减去的一个常数。</p><p>下面的代码比较了光照变化的图像的全局阈值和自适应阈值：</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'daxiongleisheng.jpg'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>img <span class="token operator">=</span> cv2<span class="token punctuation">.</span>medianBlur<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>   <span class="token comment"># 中值滤波</span></pre></td></tr><tr><td data-num="7"></td><td><pre>ret<span class="token punctuation">,</span> th1 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>th2 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>adaptiveThreshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>ADAPTIVE_THRESH_MEAN_C<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre>th3 <span class="token operator">=</span> cv2<span class="token punctuation">.</span>adaptiveThreshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>ADAPTIVE_THRESH_GAUSSIAN_C<span class="token punctuation">,</span> cv2<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Original Image'</span><span class="token punctuation">,</span> <span class="token string">'Global Thresholding (v = 127)'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>          <span class="token string">'Adaptive Mean Thresholding'</span><span class="token punctuation">,</span> <span class="token string">'Adaptive Gaussian Thresholding'</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="12"></td><td><pre>images <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">,</span> th1<span class="token punctuation">,</span> th2<span class="token punctuation">,</span> th3<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>images<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'gray'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>结果：</p><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211808867.png" alt="image-20220921154947197"></p><h2 id="otsu的二值化"><a class="anchor" href="#otsu的二值化">#</a> Otsu 的二值化</h2><p>在全局阈值化中，我们使用任意选择的值作为阈值。相反，Otsu 的方法避免了必须选择一个值并自动确定它的情况。</p><p>考虑仅具有两个不同图像值的图像（<em>双峰图像</em>），其中直方图将仅包含两个峰。一个好的阈值应该在这两个值的中间。类似地，Otsu 的方法从图像直方图中确定最佳全局阈值。</p><p>为此，使用了<strong> cv.threshold</strong> 作为附加标志传递。阈值可以任意选择。然后，算法找到最佳阈值，该阈值作为第一输出返回。</p><p>查看以下示例。输入图像为噪点图像。在第一种情况下，采用值为 127 的全局阈值。在第二种情况下，直接采用 Otsu 阈值法。在第三种情况下，首先使用 5x5 高斯核对图像进行滤波以去除噪声，然后应用 Otsu 阈值处理。了解噪声滤波如何改善结果。</p><figure class="highlight python"><figcaption data-lang="python"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">from</span> matplotlib <span class="token keyword">import</span> pyplot <span class="token keyword">as</span> plt</pre></td></tr><tr><td data-num="4"></td><td><pre>img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span><span class="token string">'noisy2.png'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 全局阈值</span></pre></td></tr><tr><td data-num="6"></td><td><pre>ret1<span class="token punctuation">,</span>th1 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token number">127</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>THRESH_BINARY<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># Otsu 阈值</span></pre></td></tr><tr><td data-num="8"></td><td><pre>ret2<span class="token punctuation">,</span>th2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>THRESH_BINARY<span class="token operator">+</span>cv<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 高斯滤波后再采用 Otsu 阈值</span></pre></td></tr><tr><td data-num="10"></td><td><pre>blur <span class="token operator">=</span> cv<span class="token punctuation">.</span>GaussianBlur<span class="token punctuation">(</span>img<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>ret3<span class="token punctuation">,</span>th3 <span class="token operator">=</span> cv<span class="token punctuation">.</span>threshold<span class="token punctuation">(</span>blur<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">255</span><span class="token punctuation">,</span>cv<span class="token punctuation">.</span>THRESH_BINARY<span class="token operator">+</span>cv<span class="token punctuation">.</span>THRESH_OTSU<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 绘制所有图像及其直方图</span></pre></td></tr><tr><td data-num="13"></td><td><pre>images <span class="token operator">=</span> <span class="token punctuation">[</span>img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> th1<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>          img<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> th2<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>          blur<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> th3<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre>titles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'Original Noisy Image'</span><span class="token punctuation">,</span><span class="token string">'Histogram'</span><span class="token punctuation">,</span><span class="token string">'Global Thresholding (v=127)'</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="17"></td><td><pre>          <span class="token string">'Original Noisy Image'</span><span class="token punctuation">,</span><span class="token string">'Histogram'</span><span class="token punctuation">,</span><span class="token string">"Otsu's Thresholding"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>          <span class="token string">'Gaussian filtered Image'</span><span class="token punctuation">,</span><span class="token string">'Histogram'</span><span class="token punctuation">,</span><span class="token string">"Otsu's Thresholding"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>images<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>hist<span class="token punctuation">(</span>images<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ravel<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>images<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'gray'</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span>titles<span class="token punctuation">[</span>i<span class="token operator">*</span><span class="token number">3</span><span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> plt<span class="token punctuation">.</span>yticks<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p><img data-src="https://fastly.jsdelivr.net/gh/HMJ-Modesty/img@main/img/202209211808209.png" alt="image-20220921162330081"></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2022-09-21 18:09:07" itemprop="dateModified" datetime="2022-09-21T18:09:07+08:00">2022-09-21</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="Modesty 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="Modesty 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="Modesty 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>Modesty <i class="ic i-at"><em>@</em></i>Modesty</li><li class="link"><strong>本文链接：</strong> <a href="https://hmj-modesty.github.io/2022/08/27/computer-science/AI-learn/AIlearn/opencv%E5%9F%BA%E7%A1%80/" title="opencv 基础">https://hmj-modesty.github.io/2022/08/27/computer-science/AI-learn/AIlearn/opencv基础/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/08/16/computer-science/AI-learn/AIlearn/Numpy%E5%9F%BA%E7%A1%80/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyonbf9j20zk0m8e81.jpg" title="numpy基础"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 人工智能基础</span><h3>numpy基础</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%85%A5%E9%97%A8"><span class="toc-number">1.</span> <span class="toc-text">图像入门</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E4%B8%80%E4%B8%AA%E7%AA%97%E5%8F%A3%E5%8A%A0%E8%BD%BD%E5%9B%BE%E5%83%8F"><span class="toc-number">1.1.</span> <span class="toc-text">创建一个窗口加载图像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%99%E5%85%A5%E5%9B%BE%E5%83%8F"><span class="toc-number">1.2.</span> <span class="toc-text">写入图像</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%97%E9%A2%98"><span class="toc-number">1.2.1.</span> <span class="toc-text">列题：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8matplotlib"><span class="toc-number">1.3.</span> <span class="toc-text">使用 Matplotlib</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A7%86%E9%A2%91%E5%85%A5%E9%97%A8"><span class="toc-number">2.</span> <span class="toc-text">视频入门</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87"><span class="toc-number">2.0.1.</span> <span class="toc-text">目标</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E7%9B%B8%E6%9C%BA%E4%B8%AD%E8%AF%BB%E5%8F%96%E8%A7%86%E9%A2%91"><span class="toc-number">2.1.</span> <span class="toc-text">从相机中读取视频</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E8%A7%86%E9%A2%91%E6%96%87%E4%BB%B6%E4%B8%AD%E8%AF%BB%E5%8F%96%E8%A7%86%E9%A2%91"><span class="toc-number">2.2.</span> <span class="toc-text">从视频文件中读取视频</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%9D%E5%AD%98%E8%A7%86%E9%A2%91"><span class="toc-number">2.3.</span> <span class="toc-text">保存视频</span></a></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#opencv%E4%B8%AD%E7%9A%84%E7%BB%98%E5%9B%BE%E5%8A%9F%E8%83%BD"><span class="toc-number">3.</span> <span class="toc-text">OpenCV 中的绘图功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-2"><span class="toc-number">3.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%A0%B7%E5%BC%8F"><span class="toc-number">3.2.</span> <span class="toc-text">代码样式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%BB%E7%BA%BF"><span class="toc-number">3.2.0.1.</span> <span class="toc-text">画线</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%BB%E7%9F%A9%E5%BD%A2"><span class="toc-number">3.2.0.2.</span> <span class="toc-text">画矩形</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%BB%E5%9C%86%E5%9C%88"><span class="toc-number">3.2.0.3.</span> <span class="toc-text">画圆圈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%BB%E6%A4%AD%E5%9C%86"><span class="toc-number">3.2.0.4.</span> <span class="toc-text">画椭圆</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%94%BB%E5%A4%9A%E8%BE%B9%E5%BD%A2"><span class="toc-number">3.2.0.5.</span> <span class="toc-text">画多边形</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%91%E5%9B%BE%E5%83%8F%E6%B7%BB%E5%8A%A0%E6%96%87%E6%9C%AC"><span class="toc-number">3.2.0.6.</span> <span class="toc-text">向图像添加文本：</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E7%94%BB%E7%AC%94"><span class="toc-number">4.</span> <span class="toc-text">鼠标画笔</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-3"><span class="toc-number">4.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">4.2.</span> <span class="toc-text">补充:</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0"><span class="toc-number">4.2.1.</span> <span class="toc-text">参数：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">4.2.2.</span> <span class="toc-text">参数说明：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%BC%A0%E6%A0%87%E4%BA%8B%E4%BB%B6%E4%B8%BB%E8%A6%81%E6%9C%89%E4%B8%8B%E9%9D%A2%E5%87%A0%E7%A7%8D"><span class="toc-number">4.2.3.</span> <span class="toc-text">鼠标事件主要有下面几种：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA"><span class="toc-number">4.3.</span> <span class="toc-text">代码演示</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%A8%E8%BF%B9%E6%A0%8F%E4%BD%9C%E4%B8%BA%E8%B0%83%E8%89%B2%E6%9D%BF"><span class="toc-number">5.</span> <span class="toc-text">轨迹栏作为调色板</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-4"><span class="toc-number">5.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-2"><span class="toc-number">5.2.</span> <span class="toc-text">代码演示</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%BB%91%E5%8A%A8%E6%9D%A1createtrackbar-%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.1.</span> <span class="toc-text">创建滑动条：createTrackbar 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%BD%93%E5%89%8D%E8%BD%A8%E8%BF%B9%E6%9D%A1%E7%9A%84%E4%BD%8D%E7%BD%AEgettrackbarpos-%E5%87%BD%E6%95%B0"><span class="toc-number">5.2.2.</span> <span class="toc-text">获取当前轨迹条的位置：getTrackbarPos 函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%BC%94%E7%A4%BA-3"><span class="toc-number">5.3.</span> <span class="toc-text">代码演示</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%A5%E5%85%85%E7%9F%A5%E8%AF%86%E7%82%B9"><span class="toc-number">5.4.</span> <span class="toc-text">补充知识点:</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">6.</span> <span class="toc-text">图像的基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-5"><span class="toc-number">6.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%9B%BE%E5%83%8F"><span class="toc-number">6.2.</span> <span class="toc-text">读取图像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%92%8C%E4%BF%AE%E6%94%B9%E5%83%8F%E7%B4%A0%E5%80%BC"><span class="toc-number">6.3.</span> <span class="toc-text">访问和修改像素值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%99%AE%E9%80%9A%E4%BF%AE%E6%94%B9%E6%B3%95"><span class="toc-number">6.3.1.</span> <span class="toc-text">普通修改法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#numpy%E6%95%B0%E7%BB%84%E6%96%B9%E6%B3%95arrayitem%E5%92%8Carrayitemset"><span class="toc-number">6.3.2.</span> <span class="toc-text">Numpy 数组方法 array.item () 和 array.itemset ())</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%9B%BE%E5%83%8F%E5%B1%9E%E6%80%A7"><span class="toc-number">6.4.</span> <span class="toc-text">访问图像属性</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%B1%9E%E6%80%A7%E5%8C%85%E6%8B%AC%E8%A1%8C%E6%95%B0%E5%88%97%E6%95%B0%E5%92%8C%E9%80%9A%E9%81%93%E6%95%B0%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E5%83%8F%E7%B4%A0%E6%95%B0%E7%AD%89"><span class="toc-number">6.4.1.</span> <span class="toc-text">图像属性包括行数，列数和通道数，图像数据类型，像素数等。</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%83%8F%E7%B4%A0%E6%80%BB%E6%95%B0%E5%8F%AF%E9%80%9A%E8%BF%87%E8%AE%BF%E9%97%AEimgsize"><span class="toc-number">6.4.2.</span> <span class="toc-text">像素总数可通过访问 img.size ：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E9%80%9A%E8%BF%87imgdtype%E8%8E%B7%E5%BE%97"><span class="toc-number">6.4.3.</span> <span class="toc-text">图像数据类型通过 img.dtype 获得：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E6%84%9F%E5%85%B4%E8%B6%A3%E5%8C%BA%E5%9F%9Froi"><span class="toc-number">6.5.</span> <span class="toc-text">图像感兴趣区域 ROI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%86%E5%88%86%E5%92%8C%E5%90%88%E5%B9%B6%E5%9B%BE%E5%83%8F%E9%80%9A%E9%81%93"><span class="toc-number">6.6.</span> <span class="toc-text">拆分和合并图像通道</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E9%81%93%E5%90%88%E5%B9%B6"><span class="toc-number">6.7.</span> <span class="toc-text">通道合并</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E5%9B%BE%E5%83%8F%E8%AE%BE%E7%BD%AE%E8%BE%B9%E6%A1%86%E5%A1%AB%E5%85%85"><span class="toc-number">6.8.</span> <span class="toc-text">为图像设置边框（填充）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E4%B8%8A%E7%9A%84%E7%AE%97%E6%9C%AF%E8%BF%90%E7%AE%97"><span class="toc-number">7.</span> <span class="toc-text">图像上的算术运算</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-6"><span class="toc-number">7.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E5%8A%A0%E6%B3%95"><span class="toc-number">7.2.</span> <span class="toc-text">图像加法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E8%9E%8D%E5%90%88"><span class="toc-number">7.3.</span> <span class="toc-text">图像融合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8C%89%E4%BD%8D%E8%BF%90%E7%AE%97"><span class="toc-number">7.4.</span> <span class="toc-text">按位运算</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E4%BD%8D%E4%B8%8E%E8%BF%90%E7%AE%97"><span class="toc-number">7.4.1.</span> <span class="toc-text">按位与运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E4%BD%8D%E6%88%96%E8%BF%90%E7%AE%97"><span class="toc-number">7.4.2.</span> <span class="toc-text">按位或运算</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E4%BD%8D%E9%9D%9E%E5%8F%96%E5%8F%8D"><span class="toc-number">7.4.3.</span> <span class="toc-text">按位非（取反）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%89%E4%BD%8D%E5%BC%82%E6%88%96"><span class="toc-number">7.4.4.</span> <span class="toc-text">按位异或</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A9%E7%A0%81"><span class="toc-number">7.4.5.</span> <span class="toc-text">掩码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A0%E6%B0%B4%E5%8D%B0"><span class="toc-number">7.4.6.</span> <span class="toc-text">加水印</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E8%A1%A1%E9%87%8F%E5%92%8C%E6%8F%90%E5%8D%87%E6%8A%80%E6%9C%AF"><span class="toc-number">8.</span> <span class="toc-text">性能衡量和提升技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-7"><span class="toc-number">8.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8opencv%E8%A1%A1%E9%87%8F%E6%80%A7%E8%83%BD"><span class="toc-number">8.2.</span> <span class="toc-text">使用 OpenCV 衡量性能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#opencv%E4%B8%AD%E7%9A%84%E9%BB%98%E8%AE%A4%E4%BC%98%E5%8C%96"><span class="toc-number">8.3.</span> <span class="toc-text">OpenCV 中的默认优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8ipython%E4%B8%AD%E8%A1%A1%E9%87%8F%E6%80%A7%E8%83%BD"><span class="toc-number">8.4.</span> <span class="toc-text">在 IPython 中衡量性能</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">8.4.1.</span> <span class="toc-text">性能优化技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%B5%84%E6%BA%90"><span class="toc-number">8.4.2.</span> <span class="toc-text">其他资源</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%94%B9%E5%8F%98%E9%A2%9C%E8%89%B2%E7%A9%BA%E9%97%B4"><span class="toc-number">9.</span> <span class="toc-text">改变颜色空间</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-8"><span class="toc-number">9.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E8%BF%BD%E8%B8%AA"><span class="toc-number">9.2.</span> <span class="toc-text">对象追踪</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cv2inrange%E5%87%BD%E6%95%B0"><span class="toc-number">9.2.1.</span> <span class="toc-text">cv2.inRange 函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cvbitwise_and%E5%87%BD%E6%95%B0"><span class="toc-number">9.2.2.</span> <span class="toc-text">cv.bitwise_and 函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0%E8%A6%81%E8%BF%BD%E8%B8%AA%E7%9A%84hsv%E5%80%BC"><span class="toc-number">9.3.</span> <span class="toc-text">如何找到要追踪的 HSV 值？</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%83%E4%B9%A0%E9%A2%98"><span class="toc-number">9.3.1.</span> <span class="toc-text">练习题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E7%9A%84%E5%87%A0%E4%BD%95%E5%8F%98%E6%8D%A2"><span class="toc-number">10.</span> <span class="toc-text">图像的几何变换</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-9"><span class="toc-number">10.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%98%E6%8D%A2"><span class="toc-number">10.2.</span> <span class="toc-text">变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%A9%E6%94%BE"><span class="toc-number">10.3.</span> <span class="toc-text">缩放</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%92%E5%85%A5%E6%96%B9%E5%BC%8F"><span class="toc-number">10.3.1.</span> <span class="toc-text">插入方式：</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B3%E7%A7%BB"><span class="toc-number">10.4.</span> <span class="toc-text">平移</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AD%A6%E5%91%8A"><span class="toc-number">10.4.1.</span> <span class="toc-text">警告</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC"><span class="toc-number">10.5.</span> <span class="toc-text">旋转</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BF%E5%B0%84%E5%8F%98%E6%8D%A2"><span class="toc-number">10.6.</span> <span class="toc-text">仿射变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%8F%E8%A7%86%E5%8F%98%E6%8D%A2"><span class="toc-number">10.7.</span> <span class="toc-text">透视变换</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8A%E9%9D%A2%E4%B8%A4%E4%B8%AA%E8%BF%98%E6%B2%A1%E6%9C%89%E5%BC%84%E6%87%82%E4%BB%A5%E5%90%8E%E5%9C%A8%E8%AF%B4"><span class="toc-number">10.8.</span> <span class="toc-text">上面两个还没有弄懂，以后在说！！！</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9B%BE%E5%83%8F%E9%98%88%E5%80%BC"><span class="toc-number">11.</span> <span class="toc-text">图像阈值</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87-10"><span class="toc-number">11.1.</span> <span class="toc-text">目标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E9%98%88%E5%80%BC"><span class="toc-number">11.2.</span> <span class="toc-text">简单阈值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%87%AA%E9%80%82%E5%BA%94%E9%98%88%E5%80%BC"><span class="toc-number">11.3.</span> <span class="toc-text">自适应阈值</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#otsu%E7%9A%84%E4%BA%8C%E5%80%BC%E5%8C%96"><span class="toc-number">11.4.</span> <span class="toc-text">Otsu 的二值化</span></a></li></ol></li></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2022/08/13/computer-science/AI-learn/AIlearn/Matplotlib%E5%9F%BA%E7%A1%80/" rel="bookmark" title="Matplotlib基础">Matplotlib基础</a></li><li><a href="/2022/08/16/computer-science/AI-learn/AIlearn/Numpy%E5%9F%BA%E7%A1%80/" rel="bookmark" title="numpy基础">numpy基础</a></li><li class="active"><a href="/2022/08/27/computer-science/AI-learn/AIlearn/opencv%E5%9F%BA%E7%A1%80/" rel="bookmark" title="opencv基础">opencv基础</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="Modesty" data-src="/images/avatar.jpg"><p class="name" itemprop="name">Modesty</p><div class="description" itemprop="description">欢迎来到 Modesty 妄想的 Blog!!!</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">32</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">17</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">5</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0hNSi1Nb2Rlc3R5" title="https:&#x2F;&#x2F;github.com&#x2F;HMJ-Modesty"><i class="ic i-github"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友達</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/programming-anguage/" title="分类于 编程语言">编程语言</a> <i class="ic i-angle-right"></i> <a href="/categories/programming-anguage/python/" title="分类于 python">python</a> <i class="ic i-angle-right"></i> <a href="/categories/programming-anguage/python/%E5%BC%82%E5%B8%B8/" title="分类于 异常">异常</a> <i class="ic i-angle-right"></i> <a href="/categories/programming-anguage/python/%E5%BC%82%E5%B8%B8/%E6%A8%A1%E5%9D%97%E5%92%8C%E5%8C%85/" title="分类于 模块和包">模块和包</a></div><span><a href="/2022/08/10/programming-anguage/python/%E5%BC%82%E5%B8%B8-%E6%A8%A1%E5%9D%97%E5%92%8C%E5%8C%85/" title="异常,模块和包">异常,模块和包</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/note/" title="分类于 二进制杂谈">二进制杂谈</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/note/theme-shoka-doc/" title="分类于 Theme Shoka Documentation">Theme Shoka Documentation</a></div><span><a href="/2020/08/13/computer-science/note/theme-shoka-doc/" title="Hexo主题Shoka &amp; multi-markdown-it渲染器使用说明">Hexo主题Shoka & multi-markdown-it渲染器使用说明</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/web/" title="分类于 网络安全">网络安全</a> <i class="ic i-angle-right"></i> <a href="/categories/web/bachanglianxi/" title="分类于 靶场练习">靶场练习</a> <i class="ic i-angle-right"></i> <a href="/categories/web/bachanglianxi/sql-labs%E5%85%A8%E9%80%9A%E5%85%B3/" title="分类于 sql-labs 全通关">sql-labs 全通关</a></div><span><a href="/2022/07/29/web/bachanglianxi/sql-labs%E5%85%A8%E9%80%9A%E5%85%B3/" title="sql-labs全通关">sql-labs全通关</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2013/12/25/excerpts/" title="Excerpts">Excerpts</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2019/07/25/code-highlight/" title="Code Highlight Style test">Code Highlight Style test</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2013/12/24/%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%86%E3%82%B9%E3%83%88/" title="日本語テスト">日本語テスト</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2013/12/25/videos/" title="Videos">Videos</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/08/11/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD%E5%9F%BA%E7%A1%80/" title="人工智能基础">人工智能基础</a></span></li><li class="item"><div class="breadcrumb"></div><span><span class="exturl" data-url="aHR0cDovL3d3dy5nb29nbGUuY29tLw==" title="www.google.com">www.google.com<i class="ic i-link-alt"></i></span></span></li><li class="item"><div class="breadcrumb"><a href="/categories/computer-science/" title="分类于 计算机科学">计算机科学</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/AI-learn/" title="分类于 人工智能">人工智能</a> <i class="ic i-angle-right"></i> <a href="/categories/computer-science/AI-learn/AIlearn/" title="分类于 人工智能基础">人工智能基础</a></div><span><a href="/2022/08/13/computer-science/AI-learn/AIlearn/Matplotlib%E5%9F%BA%E7%A1%80/" title="Matplotlib基础">Matplotlib基础</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2022</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">Modesty @ Yume Shoka</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">187k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:50</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/08/27/computer-science/AI-learn/AIlearn/opencv基础/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>